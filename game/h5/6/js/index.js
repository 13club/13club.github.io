var activeScreen=document.querySelector(".screen.is-active");var menuScreen=document.querySelector(".screen.menu");var gameScreen=document.querySelector(".screen.game");var winScreen=document.querySelector(".screen.win");var settingsScreen=document.querySelector(".screen.settings");var scoreboardScreen=document.querySelector(".screen.scoreboard");var scoreBoard=document.querySelector(".js-scoreboard");var player=document.querySelector(".player");var tongue=document.querySelector(".tongue");var eyes=document.querySelectorAll(".eye");var pupils=document.querySelectorAll(".pupil");var deadFly=document.querySelector(".tongue .fly");var paths=document.querySelectorAll(".path");var targets=document.querySelectorAll(".target");var scoreEls=document.querySelectorAll(".js-score");var bestEls=document.querySelectorAll(".js-best");var timerEl=document.querySelector(".js-time");var highscoreEl=document.querySelector(".js-highscore");var timerIntervalId;var musicPlaying=false;var musicButton=document.querySelector(".js-toggle-music");var music=document.querySelector("#music");var state={};var hidden=[];var theme;var scores=[];var shooting=false;var playing=false;var transitioning=false;var lastPath=false;var storage=window.localStorage;var clickOrTap=((window.document.documentElement.ontouchstart!==null)?"click":"touchstart");init();function init(){prepPaths();loadStorage();renderBest();toggleScreen(menuScreen)}function prepPaths(){for(var a=0;a<paths.length;a++){paths[a].setAttribute("data-id",a)}}function loadStorage(){theme=storage.getItem("theme");if(!theme){theme="light"}scores=storage.getItem("scores");if(!scores){scores=[]}else{scores=JSON.parse(scores)}toggleTheme(theme);renderScoreBoard()}function renderScoreBoard(){var b="";for(var a=0;a<10;a++){b+="<li>";b+=scores[a]||"-";b+="</li>"}scoreBoard.innerHTML=b}function setState(){state={time:30,score:0}}function toggleMusic(){musicPlaying=!musicPlaying;if(musicPlaying){music.play();musicButton.textContent="Stop Music"}else{music.pause();music.currentTime=0;musicButton.textContent="Play Music"}}function play(){playing=true;setState();renderScore();toggleScreen(gameScreen);peep();peep();peep();peep();startTimer()}function win(){playing=false;var a=scores[0]||0;scores.push(state.score);scores.sort(function(d,c){return c-d});if(scores.length>10){scores.pop()}saveScores();var b=scores[0]||0;if(state.score>a){b=state.score;highscoreEl.classList.remove("is-hidden")}else{highscoreEl.classList.add("is-hidden")}renderBest(b);renderScoreBoard();toggleScreen(winScreen)}function renderBest(){for(var a=0;a<bestEls.length;a++){bestEls[a].textContent=scores[0]}}function saveScores(){storage.setItem("scores",JSON.stringify(scores))}function menu(){toggleScreen(menuScreen)}function settings(){toggleScreen(settingsScreen)}function scoreboard(){toggleScreen(scoreboardScreen)}function startTimer(){timerEl.textContent=state.time;timerIntervalId=setInterval(function(a){state.time-=1;timerEl.textContent=state.time;if(state.time<=0){clearInterval(timerIntervalId);win()}},1000)}function score(a){state.score+=a||1;renderScore()}function renderScore(){for(var a=0;a<scoreEls.length;a++){scoreEls[a].textContent=state.score}}function toggleScreen(a){if(activeScreen){activeScreen.classList.remove("is-active")}a.classList.add("is-active");activeScreen=a}function toggleTheme(a){document.body.classList.remove(theme);document.body.classList.add(a);theme=a;storage.setItem("theme",a)}window.onmousemove=eyesFollow;window.document.addEventListener(clickOrTap,shoot);for(var i=0;i<targets.length;i++){targets[i].addEventListener(clickOrTap,hit)}function shoot(f){eyesFollow(f);player.classList.remove("is-active");tongue.style.height=0+"px";tongue.style.transform="rotate("+0+"deg)";var c=tongue.getBoundingClientRect().left+(tongue.offsetWidth);var b=tongue.getBoundingClientRect().bottom;var j=getTouch(f);var h=j.x+(tongue.offsetWidth/2);var d=j.y;shooting=true;transitioning=true;var g=getAngle(c,b,h,d);var a=getHeight(c,b,h,d);if(g>0&&g<180){player.classList.add("is-shooting-down")}else{player.classList.remove("is-shooting-down")}player.classList.add("is-active");tongue.style.height=a+"px";tongue.style.transform="rotate("+(g+90)+"deg)"}function hit(b){var a=this.parentNode;var c=a.getAttribute("data-id");if(!b.isTrusted||hidden.includes(c)){return}if(state.score%2==0){deadFly.classList.add("is-active2");deadFly.classList.remove("is-active")}else{deadFly.classList.add("is-active");deadFly.classList.remove("is-active2")}a.classList.remove("is-active");a.classList.add("is-hidden");hidden.push(c);setTimeout(function(){var d=hidden.shift();paths[d].classList.remove("is-hidden")},1000);score()}function eyesFollow(a){var b=getTouch(a);moveEye({x:b.x,y:b.y},eyes[0],pupils[0]);moveEye({x:b.x,y:b.y},eyes[1],pupils[1])}function moveEye(h,f,o){var c=0;var l=0;var g=f.offsetWidth/2;var m=o.offsetWidth/2;var b=f.getBoundingClientRect().left;var e=f.getBoundingClientRect().top;var a=[f.getBoundingClientRect().left+g,f.getBoundingClientRect().top+g];
  var j=getDistance([h.x,h.y],a);if(j<=g){c=h.x-b-g;l=h.y-e-g}else{var n=h.x-a[0];var k=h.y-a[1];var d=Math.atan2(k,n);c=(Math.cos(d)*(g-m));l=(Math.sin(d)*(g-m))}o.style.transform="translate("+c+"px, "+l+"px)"}function getRandomPath(b){const a=Math.floor(Math.random()*paths.length);const c=paths[a];if(c===lastPath||paths[a].classList.contains("is-hidden")){return getRandomPath(paths)}lastPath=c;return c}function peep(){const b=getRandomTime(600,1200);const a=getRandomPath(paths);a.classList.add("is-active");setTimeout(function(){a.classList.remove("is-active");if(playing){peep()}},b)}function getRandomTime(b,a){return Math.round(Math.random()*(a-b)+b)}function getDistance(f,e){var b=f[0],d=f[1],a=e[0],c=e[1];return Math.sqrt(Math.pow(b-a,2)+Math.pow(d-c,2))}function getAngle(a,g,f,d){var b=d-g;var c=f-a;var e=(Math.atan2(b,c))*180/Math.PI;return e}function getHeight(f,h,e,g){var d=f-e;var c=h-g;return Math.sqrt(d*d+c*c)}function getTouch(a){if(a.touches){return{x:a.touches[0].clientX,y:a.touches[0].clientY}}else{return{x:a.clientX,y:a.clientY}}};