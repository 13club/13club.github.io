var link,jsGame;(function(){var e=window.eval,t=function(e,t,n){var r=n||{};if(t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.prototype.superClass=t.prototype,i=null}for(var s in r){e.prototype[s]=r[s]}return r=null,e};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout}(),String||(String={}),String.format||(String.format=function(){if(arguments.length==0){return null}var e=arguments[0]||"",t;for(var n=1,r=arguments.length;n<r;n++){t=new RegExp("\\{"+(n-1)+"\\}","gm"),e=e.replace(t,arguments[n])}return t=null,e}),String.getByteLength||(String.getByteLength=function(e){var t,n=0,r=e||"",i=r.length;for(t=0;t<i;t++){r.charCodeAt(t)>=0&r.charCodeAt(t)<=255?n+=1:n+=2}return t=r=i=null,n});if(!Array||!Array.prototype){Array.prototype={}}Array.prototype.indexOfAttr=function(e,t){var n=(typeof e).toLowerCase(),r=-1;for(var i=0,s=this.length;i<s;i++){if(n=="string"&&this[i][e]==t||n=="number"&&this[i]==e){r=i;break}}return n=null,r};var n={canvas:{id:"linkScreen",defaultId:"linkScreen",defaultFont:"12px Arial",defaultWidth:240,defaultHeight:320,defaultColor:"rgb(0, 0, 0)",bgColor:"#000",cavansDoms:[],ctxs:[],device:"",fps:1,touch:!1,zoom:1},system:{loadRes:null,pageLoad:null,menu:null,run:null,runFn:function(){},rafRun:null,stop:null,over:null,zone:null,active:null,lastDate:Date.now(),timeout:30,isPause:!1,gameFlow:-1,loadedImageToGameFlow:-1,zoneArgs:null,activeArgs:null,spendTime:0,loadResTimer:null,playTimer:null},event:{key:0,keys:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},lastKey:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},pressedKey:{up:!1,down:!1,left:!1,right:!1,a:!1,b:!1,c:!1,menu:!1,quit:!1},keyPressCtrl:{up:!0,down:!0,left:!0,right:!0,a:!0,b:!0,c:!0,menu:!0,quit:!0},keyDownGo:!1,keyUpGo:!1,keyPressedGo:!1,keyDownCallBack:null,keyUpCallBack:null,orientationChange:null,touchStart:null,touchEnd:null,touchMove:null,touchCancel:null,clickCallBack:null,mouseDownCallBack:null,mouseUpCallBack:null,mouseMoveCallBack:null,focused:!1,pageFocusCallBack:null,pageUnFocusCallBack:null,swipeCallBack:null,pageOffX:0,pageOffY:0,pageStarOffX:0,pageStarOffY:0,swipeDate:null,swipeTimeout:200,swipeRange:50},image:{imgs:{},imgObjs:[],initImgs:{},asyncImgObjs:{},imgCount:0,countLoaded:0,version:"",inited:!1},audio:{audios:{}},ajax:{xhrObj:null,pool:[],poolLength:5,date:null,isTimeout:!1,param:{type:"get",data:null,dataType:"json",url:"",xhr:null,timeout:5000,before:function(e){},success:function(e,t){},error:function(e,t){},complete:function(e){}}},request:{gets:[]},buttonLayout:{buttons:[],Button:t(function(e){this.id=e.id,this.value=e.value,this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this.bgColor=e.bgColor,this.bgStroke=e.bgStroke,this.stroke=e.stroke,this.font=e.font,this.imageId=e.imageId,this.sx=e.sx,this.sy=e.sy,this.color=e.color,this.hx=e.hx,this.hy=e.hy,this.hColor=e.hColor,this.dex=e.dex,this.dey=e.dey,this.deColor=e.deColor,this.hided=e.hided,this.disabled=e.disabled,this.path=e.path,this.hovered=!1,this.repeated=!1,this.pressed=!1,this.released=!1,this.goned=!1,this.cacheId="buttonLayoutCache_"+this.id,this.setDelay(e.delay).refresh()},null,{refresh:function(){m.canvas.pass(this.cacheId,this.width*3,this.height),this.imageId==""?(this.bgColor!=""&&m.canvas.fillStyle(this.bgColor).fillRect(0,0,this.width,this.height).fillRect(this.width,0,this.width,this.height).fillRect(this.width*2,0,this.width,this.height),this.bgStroke!=""&&m.canvas.strokeStyle(this.bgStroke).strokeRect(1,1,this.width-2,this.height-2).strokeRect(this.width+1,1,this.width-2,this.height-2).strokeRect(this.width*2+1,1,this.width-2,this.height-2)):m.canvas.drawImage(this.imageId,this.sx,this.sy,this.width,this.height,0,0,this.width,this.height).drawImage(this.imageId,this.hx,this.hy,this.width,this.height,this.width,0,this.width,this.height).drawImage(this.imageId,this.dex,this.dey,this.width*2,this.height,this.width*2,0,this.width,this.height);if(this.value!=""){var e=m.canvas.font(this.font).measureText(this.value),t=this.width-e.width>>1,n=(this.height-e.height>>1)+parseInt(this.font)-2;this.stroke!=""&&m.canvas.fillStyle(this.stroke).fillText(this.value,t-1,n).fillText(this.value,t,n-1).fillText(this.value,t+1,n).fillText(this.value,t,n+1).fillText(this.value,t+this.width-1,n).fillText(this.value,t+this.width,n-1).fillText(this.value,t+this.width+1,n).fillText(this.value,t+this.width,n+1).fillText(this.value,t+this.width*2-1,n).fillText(this.value,t+this.width*2,n-1).fillText(this.value,t+this.width*2+1,n).fillText(this.value,t+this.width*2,n+1),m.canvas.fillStyle(this.color).fillText(this.value,t,n).fillStyle(this.hColor).fillText(this.value,t+this.width,n).fillStyle(this.deColor).fillText(this.value,t+this.width*2,n),e=t=n=null
}return m.canvas.pass(),this},show:function(){return this.hided=!1,this},hide:function(){return this.hided=!0,this},disable:function(e){return this.disabled=e,this},setPath:function(e,t){return this.setDelay(t).path=e||[],this},endPath:function(){return this.path.length==0},gone:function(e,t){return this.setPath(e,t).goned=!0,this},setDelay:function(e){return this.delay=e||0,this.delayDate=null,this.delay>0&&(this.delayDate=Date.now()),this},action:function(){if(this.hided){return this}this.delayDate&&Date.now()-this.delayDate>=this.delay&&(this.delayDate=null);if(!this.delayDate&&this.path.length>0){var e=this.path.shift();this.x+=e[0],this.y+=e[1],e=null}return this},render:function(){return this.hided?this:(m.canvas.drawCache(this.cacheId,this.hovered?this.width:this.disabled?this.width*2:0,0,this.width,this.height,this.x,this.y,this.width,this.height),this)},disposed:function(){return this}})}},r={canvas:{context:{base:0},graphics:{HCENTER:1,VCENTER:2,LEFT:4,RIGHT:8,TOP:16,BOTTOM:32,ANCHOR_LT:20,ANCHOR_LV:6,ANCHOR_LB:36,ANCHOR_HT:17,ANCHOR_HV:3,ANCHOR_HB:33,ANCHOR_RT:24,ANCHOR_RV:10,ANCHOR_RB:40},trans:{TRANS_MIRROR:2,TRANS_NONE:0,TRANS_ROT90:5,TRANS_ROT180:3,TRANS_ROT270:6,TRANS_MIRROR_ROT90:7,TRANS_MIRROR_ROT180:1,TRANS_MIRROR_ROT270:4}},event:{key:{up:38,down:40,left:37,right:39,a:90,b:88,c:67,menu:49,quit:50}},system:{gameFlowType:{menu:0,run:1,stop:2,over:3,zone:4,active:5,loadImage:6,loadedImage:7}}},i={getCanvasDom:function(){var e;return function(){return e||(e=m.getDom(n.canvas.defaultId)),e}}(),getOffsetX:function(e){return e.offsetX||(e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].clientX-i.getCanvasDom().offsetLeft:e.clientX-i.getCanvasDom().offsetLeft)||0},getOffsetY:function(e){return e.offsetY||(e.changedTouches&&e.changedTouches[0]?e.changedTouches[0].clientY-i.getCanvasDom().offsetTop:e.clientY-i.getCanvasDom().offsetTop)||0},keydown:function(e){var t=i.checkKey(e.keyCode);n.event.keyDownGo&&n.event.keys[t]!=undefined&&(n.event.keys[t]=!0),n.event.keyUpGo&&n.event.lastKey[t]!=undefined&&(n.event.lastKey[t]=!1),n.event.keyPressCtrl[t]&&n.event.keyPressedGo&&(n.event.pressedKey[t]!=undefined&&(n.event.pressedKey[t]=!0),n.event.keyPressCtrl[t]=!1),n.event.keyDownCallBack!=null&&n.event.keyDownCallBack(e),t=null},keyup:function(e){var t=i.checkKey(e.keyCode);n.event.keyDownGo&&n.event.keys[t]!=undefined&&(n.event.keys[t]=!1),n.event.keyUpGo&&n.event.lastKey[t]!=undefined&&(n.event.lastKey[t]=!0),n.event.keyPressedGo&&(n.event.pressedKey[t]!=undefined&&(n.event.pressedKey[t]=!1),n.event.keyPressCtrl[t]=!0),n.event.keyUpCallBack!=null&&n.event.keyUpCallBack(e),t=null},orientationchange:function(e){n.event.orientationChange!=null&&n.event.orientationChange(e)},swipeStart:function(e,t){n.event.swipeCallBack!=null&&(n.event.swipeDate=Date.now(),n.event.pageStarOffX=e,n.event.pageStarOffY=t)},swipeSuccess:function(e,t){if(n.event.swipeDate){if(Date.now()-n.event.swipeDate<n.event.swipeTimeout){if(Math.abs(e-n.event.pageStarOffX)>=n.event.swipeRange||Math.abs(t-n.event.pageStarOffY)>=n.event.swipeRange){return n.event.swipeCallBack(n.event.pageStarOffX,n.event.pageStarOffY,e,t),!0}}n.event.swipeDate=null}return !1},touchstart:function(e){e.preventDefault(),n.event.pageOffX=i.getOffsetX(e),n.event.pageOffY=i.getOffsetY(e),n.event.touchStart!=null&&n.event.touchStart(e,n.event.pageOffX,n.event.pageOffY);if(i.buttonLayoutEventHandler(e.type,n.event.pageOffX,n.event.pageOffY)){return !1}i.swipeStart(n.event.pageOffX,n.event.pageOffY)},touchend:function(e){e.preventDefault();if(i.swipeSuccess(n.event.pageOffX,n.event.pageOffY)){return !1}if(i.buttonLayoutEventHandler(e.type,n.event.pageOffX,n.event.pageOffY)){return !1}n.event.touchEnd!=null&&n.event.touchEnd(e,n.event.pageOffX,n.event.pageOffY)},touchmove:function(e){e.preventDefault(),n.event.pageOffX=i.getOffsetX(e),n.event.pageOffY=i.getOffsetY(e),n.event.touchMove!=null&&n.event.touchMove(e,n.event.pageOffX,n.event.pageOffY)},touchcancel:function(e){n.event.pageOffX=i.getOffsetX(e),n.event.pageOffY=i.getOffsetY(e),n.event.touchCancel!=null&&n.event.touchCancel(e,n.event.pageOffX,n.event.pageOffY)},click:function(e){n.event.clickCallBack!=null&&n.event.clickCallBack(e,i.getOffsetX(e),i.getOffsetY(e))},mouseDown:function(e){var t=i.getOffsetX(e),r=i.getOffsetY(e);if(i.buttonLayoutEventHandler(e.type,t,r)){return !1}n.event.mouseDownCallBack!=null&&n.event.mouseDownCallBack(e,t,r),i.swipeStart(t,r),t=r=null},mouseUp:function(e){var t=i.getOffsetX(e),r=i.getOffsetY(e);if(i.buttonLayoutEventHandler(e.type,t,r)){return !1}if(i.swipeSuccess(t,r)){return !1}n.event.mouseUpCallBack!=null&&n.event.mouseUpCallBack(e,t,r),t=r=null},mouseMove:function(e){n.event.mouseMoveCallBack!=null&&n.event.mouseMoveCallBack(e,i.getOffsetX(e),i.getOffsetY(e))},pageFocus:function(e){if(n.event.focused){return n.event.focused=!1,!1}n.event.pageFocusCallBack!=null&&n.event.pageFocusCallBack(e)},pageUnFocus:function(e){n.event.pageUnFocusCallBack!=null&&n.event.pageUnFocusCallBack(e)
},checkKey:function(e){var t="0";for(var n in r.event.key){if(r.event.key[n]==e){t=n;break}}return t},getDeviceConfig:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("duopaosafari")!=-1?{device:"duopaoSafari",fps:1,touch:!0,zoom:1}:e.indexOf("iphone")!=-1||e.indexOf("ipod")!=-1?{device:"iphone",fps:1,touch:!0,zoom:1}:e.indexOf("ipad")!=-1?{device:"ipad",fps:1,touch:!0,zoom:1}:e.indexOf("duopaoandroid")!=-1?{device:"duopaoAndroid",fps:1,touch:!0,zoom:1}:e.indexOf("duopaowindowsphone")!=-1?{device:"duopaoWindowsPhone",fps:1,touch:!0,zoom:1}:e.indexOf("opera mobi")!=-1?{device:"operamobile",fps:1,touch:!0,zoom:1}:e.indexOf("flyflow")!=-1?{device:"flyflow",fps:1,touch:!0,zoom:1}:e.indexOf("android")!=-1?{device:"android",fps:1,touch:!0,zoom:1}:e.indexOf("iemobile")!=-1?{device:"iemobile",fps:1,touch:!1,zoom:1}:e.indexOf("j2me")!=-1?{device:"j2me",fps:1,touch:!1,zoom:1}:e.indexOf("symbian v5")!=-1?{device:"symbian5",fps:1,touch:!0,zoom:1}:e.indexOf("symbian v3")!=-1?{device:"symbian3",fps:1,touch:!1,zoom:1}:e.indexOf("chrome")!=-1?{device:"chrome",fps:1,touch:!1,zoom:1}:e.indexOf("firefox")!=-1?{device:"firefox",fps:1,touch:!1,zoom:1}:e.indexOf("msie")!=-1?{device:"ie",fps:0.5,touch:!1,zoom:1}:e.indexOf("windows")!=-1?{device:"ie",fps:0.5,touch:!1,zoom:1}:e.indexOf("safari")!=-1?{device:"safari",fps:1,touch:!1,zoom:1}:e.indexOf("opera")!=-1?{device:"opera",fps:1,touch:!1,zoom:1}:{device:"",fps:1,touch:!1,zoom:1}},setImage:function(e,t,r,i,s){if(!e||!t){return !1}n.image.imgs[e]||(n.image.imgs[e]=new Image,n.image.imgs[e].onload=function(){n.image.countLoaded++,this.loaded=!0,this.cache&&m.canvas.pass(this.id,this.width,this.height).drawImage(this.id,0,0).pass().base().delImage(this.id,!0)},n.image.imgs[e].src=t+(n.image.version!=""?"?v="+n.image.version:""),n.image.imgs[e].id=e,n.image.imgs[e].url=t,n.image.imgs[e].benchId=r,n.image.imgs[e].bench=i,n.image.imgs[e].cache=s,n.image.imgs[e].refreshed=!1)},setAudio:function(e,t,r,i,s,o){if(!e||!t){return !1}if(!n.audio.audios[e]){var u=new Audio(t+(n.image.version!=""?"?v="+n.image.version:""));u.id=e,u.autoplay=i,u.preload=s,u.autobuffer=o,u.loop=r,n.audio.audios[u.id]=u,u=null}},loadingCallBack:function(e,t,r){var i=m.canvas.screen.getWidth(),s=m.canvas.screen.getHeight(),o=i,u=5,a=parseInt(i-o>>1),f=s-u,e=e>t?t:e,l=parseInt(e/t*100)+"%";m.canvas.fillStyle(n.canvas.bgColor).fillRect(0,0,i,s).fillStyle("#00FFFF").fillRect(a,f,parseInt(e/t*o),u).fillStyle("#FFF").fillText("loading "+r,5,s-10).fillText(l,i-m.canvas.measureText(l).width-5,s-10),i=s=o=u=a=f=l=null},loadingEndCallBack:null,getAnchor:function(e,t,n,i,s){var o=e,u=t;switch(s){case r.canvas.graphics.ANCHOR_HV:o-=parseInt(n/2),u-=parseInt(i/2);break;case r.canvas.graphics.ANCHOR_LV:u-=parseInt(i/2);break;case r.canvas.graphics.ANCHOR_RV:o-=n,u-=parseInt(i/2);break;case r.canvas.graphics.ANCHOR_HT:o-=parseInt(n/2);break;case 0:case r.canvas.graphics.ANCHOR_LT:default:break;case r.canvas.graphics.ANCHOR_RT:o-=n;break;case r.canvas.graphics.ANCHOR_HB:o-=parseInt(n/2),u-=i;break;case r.canvas.graphics.ANCHOR_LB:u-=i;break;case r.canvas.graphics.ANCHOR_RB:o-=n,u-=i}return{x:o,y:u}},initUrlParams:function(e){if(e.indexOf("?")>=0){var t=e.split("?"),r=[];t[1].indexOf("&")>=0?r=t[1].split("&"):r.push(t[1]);var i=[];for(var s=0;s<r.length;s++){r[s].indexOf("=")>=0&&(i=r[s].split("="),n.request.gets[i[0]]=i[1])}i=null,r=null,t=null}},audioEnded:function(){m.audio.replay(this.id)},pageLoaded:function(){n.image.inited=!0,n.system.pageLoad(m)},buttonLayoutAction:function(){var e=n.buttonLayout.buttons,t;for(var r=e.length-1;r>=0;r--){if(t=e[r]){t.action().render(),t.goned&&t.endPath()&&e.splice(r,1)}}e=t=null},buttonLayoutEventHandler:function(e,t,r){var i=n.buttonLayout.buttons,s,o=!1;for(var u=i.length-1;u>=0;u--){if(s=i[u]){if(m.comm.collision(s.x,s.y,s.width,s.height,t-5,r-5,10,10)){switch(e){case"mousedown":case"touchstart":s.hovered=!0,s.repeated=!0,s.pressed=!0,s.released=!1;break;case"mouseup":case"touchend":s.hovered&&(s.released=!0,s.hovered=!1),s.repeated=!1,s.pressed=!1;break;default:}o=!0}else{if(e=="mouseup"||e=="touchend"){s.hovered=!1,s.repeated=!1}}}}return i=s=null,o}},s,o,u,a,f,l,c,h,p,d,v={arr:[],len:0,v:0};link={init:function(e,t){return !e&&!t?(this.version=1,this.request.init(),this.canvas.initDevice(),this.localStorage.init(),this.sessionStorage.init()):(n.canvas.defaultWidth=e,n.canvas.defaultHeight=t),this},extend:t,setAjax:function(e){return n.ajax.param=this.objExtend(n.ajax.param,e||{}),this},ajax:function(e){e&&n.ajax.pool.length<n.ajax.poolLength&&n.ajax.pool.push(e),e&&e.clear&&(n.ajax.pool=[]),n.ajax.xhr||(n.ajax.xhr=new XMLHttpRequest,n.ajax.xhr.onreadystatechange=function(){if(n.ajax.isTimeout){return !1}var e=n.ajax.xhr,t=n.ajax.xhrObj;if(t&&e.readyState==4){n.ajax.date&&(clearTimeout(n.ajax.date),n.ajax.date=null);if(e.status==200){var r;switch(t.dataType){case"HTML":case"SCRIPT":case"XML":r=e.responseText;break;case"TEXT":default:r=e.responseText.replace(/<[^>].*?>/g,"");
break;case"JSON":r=m.getJson(e.responseText)}t.success(r,t),t.complete(t)}else{t.error(t,"error")}n.ajax.xhrObj=null,m.ajax()}e=t=null});if(n.ajax.xhrObj==null&&n.ajax.pool.length>0){n.ajax.xhrObj=this.objExtend(n.ajax.param,n.ajax.pool.shift()||{});var t=n.ajax.xhr,r=n.ajax.xhrObj,i=n.ajax.xhrObj.url,s=null,o=r.data;r.type=r.type.toUpperCase(),r.dataType=r.dataType.toUpperCase(),n.ajax.isTimeout=!1;if(typeof o=="string"){s=o}else{if(typeof o=="object"){s=[];for(var u in o){s.push(u+"="+o[u])}s=s.join("&")}}r.type=="GET"&&(i+="?"+s),t.open(r.type,i,!0),r.before(n.ajax.xhrObj),r.type=="POST"&&t.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),t.send(s),t=r=s=o=i=null,n.ajax.date=setTimeout(function(){m.ajax({clear:!0}),n.ajax.isTimeout=!0,n.ajax.xhrObj&&(n.ajax.xhrObj.error(n.ajax.xhrObj,"timeout"),n.ajax.xhrObj=null)},n.ajax.xhrObj.timeout)}return this},getDom:function(e){try{return document.getElementById(e)}catch(t){return document.all[e]}},objExtend:function(){var e=this.clone(arguments[0])||{},t=1,n=arguments.length,r=!1,i;typeof e=="boolean"&&(r=e,e=arguments[1]||{},t=2),typeof e!="object"&&(e={}),n==t&&(e=this,--t);if(!arguments[1]){return e}for(;t<n;t++){if((i=arguments[t])!=null){for(var s in i){var o=e[s],u=i[s];if(e===u){continue}r&&u&&typeof u=="object"&&!u.nodeType?e[s]=this.objExtend(r,o||(u.length!=null?[]:{}),u):u!==undefined&&(e[s]=u)}}}return e},getJson:function(t){var n={};try{window.JSON?n=JSON.parse(t):n=e("("+t+")")}catch(r){}return n},clone:function(){var e=arguments[0],t=e||[];if(typeof t=="object"){if(t.length!=undefined){e=[];for(var n=0,r=t.length;n<r;n++){if(t[n]===undefined){continue}t[n]!=null&&typeof t[n]=="object"?t[n].length!=undefined?e[n]=t[n].slice(0):e[n]=t[n]:e[n]=t[n]}}else{e={};for(var n in t){if(t[n]===undefined){continue}t[n]!=null&&typeof t[n]=="object"?t[n].length!=undefined?e[n]=t[n].slice(0):e[n]=t[n]:e[n]=t[n]}}}return t=null,e},classes:{},comm:{registerNotify:function(e,t){e!=null&&e.register(t)},unRegisterNotify:function(e,t){e!=null&&e.unregister(t)},getRandom:function(e,t){if(!t){var n=e;if(!n||n<0){n=0}return Math.round(Math.random()*n)}return Math.round(Math.random()*(t-e)+e)},inArray:function(e,t){var n,r=t.length;for(n=0;n<r;n++){if(e==t[n]){return n}}return -1},collision:function(e,t,n,r,i,s,o,u){return o&&Math.abs(e+(n>>1)-(i+(o>>1)))<n+o>>1&&Math.abs(t+(r>>1)-(s+(u>>1)))<r+u>>1?!0:!1},circleCollision:function(e,t,n,r,i,s){var o=Math.abs(e-r),u=Math.abs(t-i);return Math.sqrt(o*o+u*u)<n+s?!0:!1},rect2CircleCollision:function(e,t,n,r,i,s,o){var u=!1;return(u=this.circleCollision(e,t,1,i,s,o))||(u=this.circleCollision(e+n,t,1,i,s,o))||(u=this.circleCollision(e+n,t+r,1,i,s,o))||(u=this.circleCollision(e,t+r,1,i,s,o))||(u=this.collision(e,t,n,r,i-(o>>1),s-(o>>1),o,o)),u},polygonCollision:function(e,t,n,r,i,s,o,u){return this.polygonSAT(e,t,n,r,i,s,o,u)&&this.polygonSAT(t,e,i,s,n,r,u,o)},setMatrixRotate:function(e,t){if(!e||!e[0]){return null}var n=50,r=50,i,s,o=Math.PI/180*t,u=Math.sin(o),a=Math.cos(o);for(var f=0;f<e.length;f++){i=e[f][0],s=e[f][1],e[f][0]=a*i-u*s,e[f][1]=u*i+a*s}return this},createPath:function(e,t,n,r,i){var s=[],o=e||0,u=t||0,a=n||0,f=r||0,l=a-o,c=f-u,h=Math.sqrt(Math.pow(l,2)+Math.pow(c,2)),p=i||5,d=p,v=0,m=0,g,y,b=Math.atan2(c,l)/Math.PI*180;b=b>=0?b:b+360,d>=h&&(d=h>>1);while(d<h+p){d=d>h?h:d,g=d*Math.cos(b/180*Math.PI),y=d*Math.sin(b/180*Math.PI),s.unshift([g-v,y-m]),v=g,m=y,d+=p}return s.angle=b+90,o=u=a=f=l=c=h=p=d=b=null,s}},localStorage:function(){var e,t,n=function(){var e;try{e=window.localStorage,e.getItem||(e.getItem=function(){return null}),e.setItem||(e.setItem=function(){})}catch(t){e={getItem:function(){return null},setItem:function(){}}}return e};return{init:function(){return e=this,t||(t=n()),e},setItem:function(n,r){try{t.setItem(n,r)}catch(i){}return e},getItem:function(e){return t.getItem(e)},removeItem:function(n){return t.removeItem(n),e},clear:function(){return t.clear(),e},key:function(e){return t.key(e)},getLength:function(){return t.length},base:function(){return m}}}(),sessionStorage:function(){var e,t,n=function(){var e;try{e=window.sessionStorage,e.getItem||(e.getItem=function(){return null}),e.setItem||(e.setItem=function(){})}catch(t){e={getItem:function(){return null},setItem:function(){}}}return e};return{init:function(){return e=this,t||(t=n()),e},setItem:function(n,r){return t.setItem(n,r),e},getItem:function(e){return t.getItem(e)},removeItem:function(n){return t.removeItem(n),e},clear:function(){return t.clear(),e},key:function(e){return t.key(e)},getLength:function(){return t.length},base:function(){return m}}}(),pageLoad:function(e){return n.system.pageLoad==null&&(n.system.pageLoad=e,window.addEventListener("load",function(){m.main(n.system.pageLoad)},!1)),m},main:function(e){n.system.pageLoad==null&&(n.system.pageLoad=e),this.canvas.init(),this.graphics.ANCHOR_LT=r.canvas.graphics.ANCHOR_LT,this.graphics.ANCHOR_LV=r.canvas.graphics.ANCHOR_LV,this.graphics.ANCHOR_LB=r.canvas.graphics.ANCHOR_LB,this.graphics.ANCHOR_HT=r.canvas.graphics.ANCHOR_HT,this.graphics.ANCHOR_HV=r.canvas.graphics.ANCHOR_HV,this.graphics.ANCHOR_HB=r.canvas.graphics.ANCHOR_HB,this.graphics.ANCHOR_RT=r.canvas.graphics.ANCHOR_RT,this.graphics.ANCHOR_RV=r.canvas.graphics.ANCHOR_RV,this.graphics.ANCHOR_RB=r.canvas.graphics.ANCHOR_RB;
var t=this.getDom(n.canvas.defaultId);t&&(this.canvas.screen.getTouch()?(window.addEventListener("orientationchange",i.orientationchange,!1),t.addEventListener("touchstart",i.touchstart,!1),t.addEventListener("touchend",i.touchend,!1),t.addEventListener("touchmove",i.touchmove,!1),t.addEventListener("touchcancel",i.touchcancel,!1)):(document.onkeydown=i.keydown,document.onkeyup=i.keyup,t.addEventListener("click",i.click,!1),t.addEventListener("mousedown",i.mouseDown,!1),t.addEventListener("mouseup",i.mouseUp,!1),t.addEventListener("mousemove",i.mouseMove,!1))),t=null;var s=this.canvas.screen.getDevice();return s=="ipad"||s=="iphone"?(n.event.focused=!0,window.addEventListener("pageshow",i.pageFocus,!1),window.addEventListener("pagehide",i.pageUnFocus,!1)):(s=="firefox"&&(n.event.focused=!0),window.addEventListener("focus",i.pageFocus,!1),window.addEventListener("blur",i.pageUnFocus,!1)),this.canvas.fillStyle(n.canvas.bgColor).fillRect(0,0,this.canvas.screen.getWidth(),this.canvas.screen.getHeight()),n.image.inited=!1,this.gameFlow.run().base().play(),n.image.imgObjs.length>0?this.loadImage(n.image.imgObjs):i.pageLoaded(),this},menu:function(e){return typeof e=="function"&&(n.system.menu=e),this},run:function(e){return typeof e=="function"&&(n.system.runFn=e),this},stop:function(e){return typeof e=="function"&&(n.system.stop=e),this},over:function(e){return typeof e=="function"&&(n.system.over=e),this},zone:function(e){return typeof e=="function"&&(n.system.zone=e),this},active:function(e){return typeof e=="function"&&(n.system.active=e),this},play:function(){return n.system.run||(n.system.run=function(){var e=Date.now();switch(n.system.gameFlow){case r.system.gameFlowType.menu:n.system.menu();break;case r.system.gameFlowType.run:n.system.runFn();break;case r.system.gameFlowType.stop:n.system.stop();break;case r.system.gameFlowType.over:n.system.over();break;case r.system.gameFlowType.zone:n.system.zone(n.system.zoneArgs);break;case r.system.gameFlowType.active:n.system.active(n.system.activeArgs);break;case r.system.gameFlowType.loadImage:if(i.loadingCallBack!=null){var t=n.image.imgCount,s=n.image.countLoaded>t?t:n.image.countLoaded;s==t&&(n.system.gameFlow=r.system.gameFlowType.loadedImage),t>0&&i.loadingCallBack(s,t,"image"),s==t&&i.loadingEndCallBack&&(i.loadingEndCallBack(s,t,"image"),i.loadingEndCallBack=null),s=t=null}break;case r.system.gameFlowType.loadedImage:n.system.gameFlow=n.system.loadedImageToGameFlow,n.image.imgObjs=[],n.image.countLoaded=0,n.image.inited||i.pageLoaded();break;default:}i.buttonLayoutAction(),n.system.spendTime=Date.now()-e,e=null}),n.system.playTimer||(n.system.isPause=!1,(n.system.rafRun=function(){var e=Date.now();e-n.system.lastDate>=n.system.timeout-n.system.spendTime&&(n.system.lastDate=e,n.system.isPause||n.system.run()),e=null,n.system.rafRun&&(n.system.playTimer=requestAnimationFrame(n.system.rafRun))})()),this},pause:function(){return n.system.playTimer&&(n.system.isPause=!0,n.system.rafRun=null,cancelAnimationFrame(n.system.playTimer),n.system.playTimer=null),this},gameFlow:{menu:function(){return n.system.menu!=null&&(n.system.gameFlow=r.system.gameFlowType.menu,m.resetKeys()),this},run:function(){return n.system.runFn!=null&&(n.system.gameFlow=r.system.gameFlowType.run,m.resetKeys()),this},stop:function(){return n.system.stop!=null&&(n.system.gameFlow=r.system.gameFlowType.stop,m.resetKeys()),this},over:function(){return n.system.over!=null&&(n.system.gameFlow=r.system.gameFlowType.over,m.resetKeys()),this},zone:function(e){return n.system.zone!=null&&(n.system.gameFlow=r.system.gameFlowType.zone,n.system.zoneArgs=e,m.resetKeys()),this},active:function(e){return n.system.active!=null&&(n.system.gameFlow=r.system.gameFlowType.active,n.system.activeArgs=e,m.resetKeys()),this},isIn:function(e){return n.system.gameFlow==r.system.gameFlowType[e]},base:function(){return m}},resetKeys:function(){for(var e in n.event.keys){n.event.keys[e]=!1}for(var e in n.event.lastKey){n.event.lastKey[e]=!1}for(var e in n.event.pressedKey){n.event.pressedKey[e]=!1}for(var e in n.event.keyPressCtrl){n.event.keyPressCtrl[e]=!0}return this},canvas:{init:function(){return o={x:0,y:0},u={fillColor:"#000000",strokeColor:"#000000"},a={x:0,y:0},f={x:0,y:0},l={x:0,y:0,fillStyle:"#FFFFFF",strokeStyle:"#CCCCCC"},this.pass()},initDevice:function(){return h=i.getDeviceConfig(),n.canvas.device=h.device,n.canvas.fps=h.fps,n.canvas.touch=h.touch,n.canvas.zoom=h.zoom,this},pass:function(e,t,r){var i,o;return !e||e==""?i=n.canvas.defaultId:i=e,n.canvas.ctxs[i]||(o=this.base().getDom(i)||document.createElement("canvas"),n.canvas.ctxs[i]=null,delete n.canvas.ctxs[i],n.canvas.ctxs[i]=o.getContext("2d"),o.width=t?t:n.canvas.defaultWidth,o.style.width=parseInt(o.width*n.canvas.zoom)+"px",o.height=r?r:n.canvas.defaultHeight,o.style.height=parseInt(o.height*n.canvas.zoom)+"px",n.canvas.cavansDoms[i]=null,delete n.canvas.cavansDoms[i],n.canvas.cavansDoms[i]=o),s=n.canvas.ctxs[i],s.font=n.canvas.defaultFont,c=n.canvas.cavansDoms[i],p=parseInt(c.width),d=parseInt(c.height),this.screen.setId(i),this
},font:function(e){return n.canvas.defaultFont=e,s.font=n.canvas.defaultFont,this},del:function(e){return n.canvas.ctxs[e]&&(n.canvas.ctxs[e]=null,delete n.canvas.ctxs[e],n.canvas.cavansDoms[e]=null,delete n.canvas.cavansDoms[e]),this},setCurrent:function(e){return _canvas.pass(e)},screen:{setId:function(e){return n.canvas.ctxs[e]&&(n.canvas.id=e),this},getId:function(){return n.canvas.id},getWidth:function(){return p},setWidth:function(e){return n.canvas.defaultWidth=e,c&&(c.width=n.canvas.defaultWidth,c.style.width=c.width+"px",p=parseInt(c.width)),this},getHeight:function(){return d},setHeight:function(e){return n.canvas.defaultHeight=e,c&&(c.height=n.canvas.defaultHeight,c.style.height=c.height+"px",d=parseInt(c.height)),this},getDevice:function(){return n.canvas.device},getFps:function(){return n.canvas.fps},setFps:function(e){return e>0&&(n.canvas.fps=e),this},getTouch:function(){return n.canvas.touch},getZoom:function(){return n.canvas.zoom}},fillStyle:function(e){return s.fillStyle=e,this},fillRect:function(e,t,n,r,o){return n=n?n:0,r=r?r:0,o?f=i.getAnchor(e,t,n,r,o):(f.x=e,f.y=t),s.fillRect(f.x,f.y,n,r),this},fillText:function(e,t,r,i){return s.font=i||n.canvas.defaultFont,s.fillText(e,t,r),this},clearRect:function(e,t,n,r){return s.clearRect(e,t,n,r),this},clearScreen:function(){return this.clearRect(0,0,p,d)},fillScreen:function(){return this.fillRect(0,0,p,d)},strokeStyle:function(e){return s.strokeStyle=e,this},lineWidth:function(e){return s.lineWidth=e||1,this},strokeRect:function(e,t,n,r,o){return o?a=i.getAnchor(e,t,n,r,o):(a.x=e,a.y=t),s.strokeRect(a.x,a.y,n,r),this},strokeText:function(e,t,r,i){return s.font=i||n.canvas.defaultFont,s.strokeText(e,t,r),this},setColor:function(e,t,n){return n==null?(u.fillColor=e,u.strokeColor=t?t:e):(u.fillColor="rgb("+e+", "+t+", "+n+")",u.strokeColor=u.fillColor),this.fillStyle(u.fillColor).strokeStyle(u.strokeColor)},drawImage:function(e,t,r,u,a,f,l,c,h,p){var d=m.getImage(e);if(d.refreshed){this.drawCache(e,t,r,u,a,f,l,c,h,p)}else{if(d.src!=null){c!=null&&(t=t<0?0:t,c=c<=0?0.1:c),h!=null&&(r=r<0?0:r,h=h<=0?0.1:h),u!=null&&c!=null&&(u=u<=0?0.1:t+u<=d.width?u:d.width-t),a!=null&&h!=null&&(a=a<=0?0.1:r+a<=d.height?a:d.height-r),d.loaded&&(u?a?p?(o=i.getAnchor(f,l,c,h,p),s.drawImage(d,t,r,u,a,o.x,o.y,c,h)):s.drawImage(d,t,r,u,a,f,l,c,h):(o=i.getAnchor(t,r,d.width,d.height,u),s.drawImage(d,o.x,o.y)):s.drawImage(d,t,r))}else{var v=n.image.asyncImgObjs[e];v&&!v.inited&&(i.setImage(v.id,v.src,v.benchId,v.bench,v.cache),v.inited=!0),v=null}}return d=null,this},drawRotate:function(e,t,r,i,o,u,a,f,l,c){var h=parseInt(f>>1),p=parseInt(l>>1),d=m.getImage(e),v=d.src?d:n.canvas.cavansDoms[e];return u-=h,a-=p,s.save(),s.translate(u+h,a+p),s.rotate(c*Math.PI/180),s.translate(-(u+h),-(a+p)),s.drawImage(v,t,r,i,o,u,a,f,l),s.restore(),v=null,d=null,p=null,h=null,this},drawCache:function(e,t,r,u,a,f,l,c,h,p){var d=n.canvas.cavansDoms[e];return d&&(c!=null&&(t=t<0?0:t,c=c<=0?0.1:c),h!=null&&(r=r<0?0:r,h=h<=0?0.1:h),u!=null&&c!=null&&(u=u<=0?0.1:t+u<=d.width?u:d.width-t),a!=null&&h!=null&&(a=a<=0?0.1:r+a<=d.height?a:d.height-r),u?a?p?(o=i.getAnchor(f,l,c,h,p),s.drawImage(d,t,r,u,a,o.x,o.y,c,h)):s.drawImage(d,t,r,u,a,f,l,c,h):(o=i.getAnchor(t,r,d.width,d.height,u),s.drawImage(d,o.x,o.y)):s.drawImage(d,t,r)),d=null,this},drawRegion:function(e,t,n,i,o,u,a,f,l){switch(u){case r.canvas.trans.TRANS_NONE:default:s.transform(1,0,0,1,a,f);break;case r.canvas.trans.TRANS_ROT90:s.transform(0,1,-1,0,o+a,f);break;case r.canvas.trans.TRANS_ROT180:s.transform(-1,0,0,-1,i+a,o+f);break;case r.canvas.trans.TRANS_ROT270:s.transform(0,-1,1,0,a,i+f);break;case r.canvas.trans.TRANS_MIRROR:s.transform(-1,0,0,1,i+a,f);break;case r.canvas.trans.TRANS_MIRROR_ROT90:s.transform(0,-1,-1,0,o+a,i+f);break;case r.canvas.trans.TRANS_MIRROR_ROT180:s.transform(1,0,0,-1,a,o+f);break;case r.canvas.trans.TRANS_MIRROR_ROT270:s.transform(0,1,1,0,a,f)}var c=m.getImage(e),h=c.cache?this.drawCache:this.drawImage;return h(e,t,n,i,o,0,0,i,o),s.setTransform(1,0,0,1,0,0),h=null,c=null,this},drawRegionAndZoom:function(e,t,n,i,o,u,a,f,l,c,h){switch(u){case r.canvas.trans.TRANS_NONE:default:s.transform(1,0,0,1,a,f);break;case r.canvas.trans.TRANS_ROT90:s.transform(0,1,-1,0,h+a,f);break;case r.canvas.trans.TRANS_ROT180:s.transform(-1,0,0,-1,c+a,h+f);break;case r.canvas.trans.TRANS_ROT270:s.transform(0,-1,1,0,a,c+f);break;case r.canvas.trans.TRANS_MIRROR:s.transform(-1,0,0,1,c+a,f);break;case r.canvas.trans.TRANS_MIRROR_ROT90:s.transform(0,-1,-1,0,h+a,c+f);break;case r.canvas.trans.TRANS_MIRROR_ROT180:s.transform(1,0,0,-1,a,h+f);break;case r.canvas.trans.TRANS_MIRROR_ROT270:s.transform(0,1,1,0,a,f)}var p=m.getImage(e),d=p.cache?this.drawCache:this.drawImage;return d(e,t,n,i,o,0,0,c,h),s.setTransform(1,0,0,1,0,0),d=null,p=null,this},drawNumber:function(e,t,n,r,i,s,o,u,a){var f=e.toString(),l=f.length,c=u?u:n,h=a?a:r;if(o=="center"){var d=i+parseInt(p-c*l>>1);for(var v=0;v<l;v++){this.drawImage(t,parseInt(f.charAt(v))*n,0,n,r,d+v*c,s,c,h)
}d=null}else{if(o==1){for(var v=0;v<l;v++){this.drawImage(t,parseInt(f.charAt(v))*n,0,n,r,i+v*c,s,c,h)}}else{if(o==0){for(var v=l-1;v>=0;v--){this.drawImage(t,parseInt(f.charAt(v))*n,0,n,r,i-(l-1-v)*c,s,c,h,m.graphics.ANCHOR_RT)}}}}return h=null,c=null,l=null,f=null,this},moveTo:function(e,t){return s.moveTo(e,t),this},lineTo:function(e,t){return s.lineTo(e,t),this},stroke:function(){return s.stroke(),this},fill:function(){return s.fill(),this},beginPath:function(){return s.beginPath(),this},closePath:function(){return s.closePath(),this},arc:function(e,t,n,r,i,o){return s.arc(e,t,n,r,i,o),this},quadraticCurveTo:function(e,t,n,r){return s.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return s.bezierCurveTo(e,t,n,r,i,o),this},measureText:function(e){var t=s.measureText(e),n=t.width,r=t.height?t.height:parseInt(s.font);return{width:this.screen.getDevice()=="j2me"?s.measureText(e):n,height:r}},translate:function(e,t){return s.translate(e,t),this},drawLine:function(e,t,n,r){return this.beginPath().moveTo(e,t).lineTo(n,r).closePath().stroke()},drawRect:function(e,t,n,r,i){return this.strokeRect(e,t,n,r,i)},drawString:function(e,t,i,o,u,a,f,c){l.x=t,l.y=i,s.font=c||n.canvas.defaultFont;if(o){switch(o){case r.canvas.graphics.LEFT:l.x=0;break;case r.canvas.graphics.VCENTER:l.x=parseInt(this.screen.getWidth()-this.measureText(e).width>>1);break;case r.canvas.graphics.RIGHT:l.x=this.screen.getWidth()-this.measureText(e).width;break;default:}}return u&&(a?l.fillStyle=a:l.fillStyle="#000000",f?l.strokeStyle=f:l.strokeStyle="#CCCCCC",this.fillStyle(l.strokeStyle).fillText(e,l.x+1,l.y+1,c).fillStyle(l.fillStyle)),this.fillText(e,l.x,l.y,c).fillStyle(n.canvas.defaultColor)},drawSubstring:function(e,t,n,r,i,s,o,u,a,f){return this.drawString(e.substring(t,t+n),r,i,s,o,u,a,f)},clip:function(){return s.clip(),this},save:function(){return s.save(),this},restore:function(){return s.restore(),this},rect:function(e,t,n,r){return s.rect(e,t,n,r),this},rotate:function(e){return s.rotate(e),this},setTransform:function(e,t,n,r,i,o){return s.setTransform(e,t,n,r,i,o),this},scale:function(e,t){return s.scale(e,t),this},globalAlpha:function(e){return s.globalAlpha=e,this},getContext:function(){return s},base:function(){return m}},pushImage:function(e,t){if(n.image.inited){return this}var r;for(var i=0,s=e.length;i<s;i++){r=e[i],r&&!n.image.initImgs[r.id]&&(n.image.initImgs[r.id]=!0,n.image.imgObjs.push(e[i]))}return this.loadingEndCallBack(t),r=null,this},loadImage:function(e,t){if(n.system.gameFlow!=r.system.gameFlowType.loadImage&&e.length>0){n.system.loadedImageToGameFlow=n.system.gameFlow,n.system.gameFlow=r.system.gameFlowType.loadImage,n.image.imgObjs=e,n.image.imgCount=n.image.imgObjs.length,n.image.countLoaded=0;for(var s=0,o;o=n.image.imgObjs[s];s++){n.image.imgs[o.id]?n.image.countLoaded++:i.setImage(o.id,o.src,o.benchId)}this.loadingEndCallBack(t)}return this},asyncImage:function(e){var t;for(var r=0,i=e.length;r<i;r++){t=e[r]||{},n.image.asyncImgObjs[t.id]||(n.image.asyncImgObjs[t.id]=t)}return t=null,this},loadingCallBack:function(e){return typeof e=="function"&&(i.loadingCallBack=e),this},loadingEndCallBack:function(e){return typeof e=="function"&&(i.loadingEndCallBack=e),this},getImage:function(e){return n.image.imgs[e]?n.image.imgs[e]:{src:null}},delImage:function(e,t){return n.image.imgs[e]&&(n.image.imgs[e]=null,delete n.image.imgs[e],t&&(n.image.imgs[e]={id:e,loaded:!0,cache:!0,refreshed:!0})),this},audio:{play:function(e){var t=n.audio.audios[e];if(t){try{t.currentTime>=t.duration?this.replay(e):t.paused&&t.play()}catch(r){}}return t=null,this},playRange:function(e,t,r){var i=n.audio.audios[e];if(i){try{i.__timeupdateCallBack__||i.addEventListener("timeupdate",i.__timeupdateCallBack__=function(){this.currentTime>=this.__to__&&(this.loop?this.currentTime=this.__from__:this.pause())},!1),i.__from__=t==null?0:t,i.__to__=r==null?i.duration:r,this.setCurrentTime(i.id,i.__from__).play(i.id)}catch(s){}}return i=null,this},pause:function(e){if(n.audio.audios[e]){try{n.audio.audios[e].pause()}catch(t){}}return this},pauseAll:function(){for(var e in n.audio.audios){this.pause(e)}return this},mute:function(e,t){if(n.audio.audios[e]){try{n.audio.audios[e].muted=t}catch(r){}}},vol:function(e,t){if(n.audio.audios[e]){try{n.audio.audios[e].volume=t}catch(r){}}return this},loop:function(e,t){if(n.audio.audios[e]){try{n.audio.audios[e].loop=t}catch(r){}}return this},replay:function(e){return this.setCurrentTime(e,0).play(e),this},setCurrentTime:function(e,t){var r=n.audio.audios[e];if(r){try{t<0?t=0:t>r.duration&&(t=r.duration),r.currentTime=t||0}catch(i){}}return r=null,this},getAudio:function(e){return n.audio.audios[e]},del:function(e){var t=n.audio.audios[e];return t&&t.__timeupdateCallBack__&&(t.pause(),t.removeEventListener("timeupdate",t.__timeupdateCallBack__,!1),n.audio.audios[e]=null,delete n.audio.audios[e]),t=null,this},base:function(){return m}},initAudio:function(e){if(!window.Audio){return this}if(e.length>0){n.audio.audios={};
var t,r,s,o,u;for(var a=0;a<e.length;a++){t=e[a],t&&i.setAudio(t.id,t.src,t.loop,t.autoplay,t.preload,t.autobuffer)}t=r=s=o=u=null}return this},events:{keyDown:function(e){return n.event.keyDownGo||(n.event.keyDownGo=!0),n.event.keyUpGo||(n.event.keyUpGo=!0),n.event.keyPressedGo||(n.event.keyPressedGo=!0),n.event.keyDownCallBack=e,this},keyUp:function(e){return n.event.keyDownGo||(n.event.keyDownGo=!0),n.event.keyUpGo||(n.event.keyUpGo=!0),n.event.keyPressedGo||(n.event.keyPressedGo=!0),n.event.keyUpCallBack=e,this},orientationChange:function(e){return n.event.orientationChange=e,this},touchStart:function(e){return n.event.touchStart=e,this},touchEnd:function(e){return n.event.touchEnd=e,this},touchMove:function(e){return n.event.touchMove=e,this},touchCancel:function(e){return n.event.touchCancel=e,this},click:function(e){return n.event.clickCallBack=e,this},mouseDown:function(e){return n.event.mouseDownCallBack=e,this},mouseUp:function(e){return n.event.mouseUpCallBack=e,this},mouseMove:function(e){return n.event.mouseMoveCallBack=e,this},createEvent:function(e,t){var n=document.getElementById(e);if(n){var r=document.createEvent("HTMLEvents");r.initEvent(t,!1,!0),n.dispatchEvent(r),r=null}n=null},pageFocus:function(e){return n.event.pageFocusCallBack=e,this},pageUnFocus:function(e){return n.event.pageUnFocusCallBack=e,this},swipe:function(e,t,r){n.event.swipeCallBack=e,t!=null&&(n.event.swipeTimeout=t),r!=null&&(n.event.swipeRange=r)},base:function(){return m}},ui:{},graphics:{HCENTER:r.canvas.graphics.HCENTER,VCENTER:r.canvas.graphics.VCENTER,LEFT:r.canvas.graphics.LEFT,RIGHT:r.canvas.graphics.RIGHT,TOP:r.canvas.graphics.TOP,BOTTOM:r.canvas.graphics.BOTTOM},trans:{TRANS_NONE:r.canvas.trans.TRANS_NONE,TRANS_ROT90:r.canvas.trans.TRANS_ROT90,TRANS_ROT180:r.canvas.trans.TRANS_ROT180,TRANS_ROT270:r.canvas.trans.TRANS_ROT270,TRANS_MIRROR:r.canvas.trans.TRANS_MIRROR,TRANS_MIRROR_ROT90:r.canvas.trans.TRANS_MIRROR_ROT90,TRANS_MIRROR_ROT180:r.canvas.trans.TRANS_MIRROR_ROT180,TRANS_MIRROR_ROT270:r.canvas.trans.TRANS_MIRROR_ROT270},request:{init:function(){i.initUrlParams(location.href)},get:function(e){return n.request.gets[e]?n.request.gets[e]:""}},buttonLayout:{create:function(e){var t=this.base().objExtend({id:"",value:"",x:0,y:0,width:60,height:30,bgColor:"#000",bgStroke:"#FFF",stroke:"#000",font:"12px Arial",imageId:"",sx:0,sy:0,color:"#FFF",hx:0,hy:0,hColor:"#0FF",dex:0,dey:0,deColor:"#CCC",hided:!1,disabled:!1,path:[]},e||{});return this.get(t.id)||n.buttonLayout.buttons.push(new n.buttonLayout.Button(t)),t=null,this},clear:function(){var e=n.buttonLayout.buttons,t;for(var r=e.length-1;r>=0;r--){if(t=e[r]){t.disposed(),e.splice(r,1)}}return e=t=null,this},gone:function(e,t,n){var r=this.get(e);if(r){var i=t||[];r.gone(i,n),i=null}return r=null,this},get:function(e){var t=n.buttonLayout.buttons;return t[t.indexOfAttr("id",e)]},show:function(e){var t=this.get(e);return t&&t.show(),t=null,this},hide:function(e){var t=this.get(e);return t&&t.hide(),t=null,this},disable:function(e,t){var n=this.get(e);return n&&n.disable(t),n=null,this},repeated:function(e){var t=this.get(e);if(t){return t.repeated}},pressed:function(e){var t=this.get(e);if(t){var n=t.pressed;return t.pressed=!1,n}},released:function(e){var t=this.get(e);if(t){var n=t.released;return t.released=!1,n}},base:function(){return m}}}.init();var m=jsGame=link,g=document.getElementsByTagName("head")[0],y=null,b=null,w=null,E=null,S=function(){b&&(clearTimeout(b),b=null)};link.getScript=function(e){if(!g||y){return !1}var t=m.objExtend({url:"",before:function(){},success:function(){},error:function(e){},timeout:5000,contentType:"text/javascript",destroyed:!0},e||{});return t.url!=""&&(t.before(),y=document.createElement("script"),y.type=t.contentType,y.async=!0,y.src=t.url,y.destroyed=t.destroyed,w=t.success,E=t.error,y.onload=function(){S(),w&&(w(),w=null),this.destroyed&&g.removeChild(this),y=null},g.appendChild(y),S(),b=setTimeout(function(){S(),E&&(E("timeout"),E=null),y&&y.destroyed&&g.removeChild(y),y=null},t.timeout)),t=null,m};var x=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};link.getNewGuid=function(){return x()+x()+"-"+x()+"-"+x()+"-"+x()+"-"+x()+x()+x()},link.classes.Observer=function(){this.group=[]},link.classes.Observer.prototype.register=function(e){if(e==null){return this}var t=m.comm.inArray(e,this.group);return t==-1&&this.group.push(e),this},link.classes.Observer.prototype.unregister=function(e){if(e==null){return this}var t=m.commandFuns.inArray(e,this.group);return t>-1&&this.group.splice(t,1),this},link.classes.Observer.prototype.notify=function(e){for(var t=0;t<this.group.length;t++){this.group[t]!=null&&this.group[t](e)}return this},link.classes.Observer.prototype.clear=function(){return this.group.length>0&&this.group.splice(0,this.group.length),this},link.classes.Timer=function(e,t,n,r,i){this.id=e,this._initTime=t,this._dateTime=Date.now(),this.time=this._initTime,this.callBack=n,this.millisec=r||1000,this.data=i,this.timeout=null
},link.classes.Timer.prototype.stop=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},link.classes.Timer.prototype.start=function(e){e&&(this.time=this._initTime,this._dateTime=Date.now()),this.stop(),this.timeout=setTimeout(function(e){var t=Date.now(),n=parseInt(Math.round((t-e._dateTime)/e.millisec));e._dateTime=t,e.time-=n,e.callBack?e.callBack(e):e.stop(),e.time>=0?e.start():(e.stop(),e.time=0),t=n=null},this.millisec,this)},link.classes.WebSocket=function(e,t,n,r,i){this.ipPort=e||"",this.socket=new WebSocket(this.ipPort),this.socket.onopen=t,this.socket.onmessage=n,this.socket.onclose=r,this.socket.onerror=i},link.classes.WebSocket.prototype.send=function(e){this.socket.send(e)},link.classes.WebSocket.prototype.close=function(){this.socket.close()},link.classes.observer=link.classes.Observer,link.classes.timer=link.classes.Timer,link.classes.webSocket=link.classes.websocket=link.classes.WebSocket,link.commandFuns=link.comm,link.commandFuns.collisionCheck=link.commandFuns.collision,link.commandFuns.circleCollisionCheck=link.commandFuns.circleCollision,link.initImage=link.pushImage,typeof define=="function"&&define("lib/link",[],function(){return link})})(),define("lib/action",["lib/link"],function(d){var b=function(h,g){return h==0&&g==0?0:h>0&&g<0?1:h>0&&g==0?2:h>0&&g>0?3:h==0&&g>0?4:h<0&&g>0?5:h<0&&g==0?6:h<0&&g<0?7:0},f=function(p,h,e,j,q){var g=[];if(q.length>0){var j,m;for(var l=0;l<q.length;l++){j=[],m=q[l].frames;for(var k=0;k<m.length;k++){j.push({args:[m[k][0],m[k][1],m[k][2]],step:m[k][3]})}g.push(new d.action.sprite(j,q[l].loop,0))}return j=m=null,g}return p};d.action={},d.action.Role=function(n,w,g,k,x,h,v,q){this.imageNames=x||[],this.rects=h||[],this.frames=v||[],this.actions=q||[],this.sprites=f(n,this.imageNames,this.rects,this.frames,this.actions)||[],this.x=w||0,this.y=g||0,this.dx=0,this.dy=0,this.step=0,this.id="",this.mapOffx=this.x,this.mapOffy=this.y,this.svx=null,this.svy=null,this.current=k||0,this._cr=this.current,this.zoom=1,this.angle=0,this._zooms=[],this._angles=[],this._moveDs=[4,7,5,5,6,-5,-5,-7],this._stopDs=[0,-3,1,1,2,-1,-1,-3],this.dsIndex=4,this._path=[];var m=this.getSprite(),j=m.getFrame(),p=this.frames[j.args[0]];this._fA=p.fA,this.aR=p.aR,this.bR=p.bR,this._skipMoveDs=!1,this._stopedAction=null,p=j=m=null,this.onend=null,this.onstart=null,this._locked=!1,this.speed=5,this.links=[],this.polyAR=[[0,0],[0,0],[0,0],[0,0]],this.aabbAR=[[0,0],[0,0],[0,0],[0,0]],this.polyBR=[[0,0],[0,0],[0,0],[0,0]],this.aabbBR=[[0,0],[0,0],[0,0],[0,0]]},d.action.Role.prototype.setSprite=function(p,h,e){if(this._locked){return this}var j=p!=undefined?p:0,q=j>=0?d.trans.TRANS_NONE:d.trans.TRANS_MIRROR,g,m;this._cr!=j&&(this._cr=j,j<0&&(j=Math.abs(j)),this.current=j>=this.sprites.length?this.sprites.length-1:j,this.sprites.length>1&&this.setTrans(q),g=this.getSprite(),m=g.getFrame(),h||g.setFrame(0),e&&(this._stopedAction=this._cr),this.updateFrameParam());for(var l=0,k;k=this.links[l];l++){k.setSprite(p,h,e)}return j=trans=g=m=null,this},d.action.Role.prototype.addLinks=function(e){this.links=e||[];for(var h=0,g;g=this.links[h];h++){g.setSprite(this.getSprite().trans==d.trans.TRANS_NONE?this.current:-this.current).setStep(this.step)}return this},d.action.Role.prototype.clearLinks=function(){return this.links=[],this},d.action.Role.prototype.lockSprite=function(){return this._locked=!0,this},d.action.Role.prototype.unlockSprite=function(){return this._locked=!1,this},d.action.Role.prototype.setTrans=function(g){return this.getSprite().trans=g,this},d.action.Role.prototype.getSprite=function(g){return this.sprites[g==null?this.current:g]},d.action.Role.prototype.getFrame=function(g){return this.frames[g==null?this.getSprite().getFrame().args[0]:g]},d.action.Role.prototype.updateFrameParam=function(D){var k=this.getSprite();if(!k){return k=null,this}var e=k.getFrame(),q;if(e&&e.args){if(q=this.frames[e.args[0]]){this._fA=q.fA,this.aR=q.aR,this.bR=q.bR;var E=this.getAttackRect(),j=this.getBodyRect(),C=0,A=0,x=0,m=0;this.polyAR[0][0]=E.x,this.polyAR[0][1]=E.y,this.polyAR[1][0]=E.x+E.width,this.polyAR[1][1]=E.y,this.polyAR[2][0]=E.x+E.width,this.polyAR[2][1]=E.y+E.height,this.polyAR[3][0]=E.x,this.polyAR[3][1]=E.y+E.height,this.polyBR[0][0]=j.x,this.polyBR[0][1]=j.y,this.polyBR[1][0]=j.x+j.width,this.polyBR[1][1]=j.y,this.polyBR[2][0]=j.x+j.width,this.polyBR[2][1]=j.y+j.height,this.polyBR[3][0]=j.x,this.polyBR[3][1]=j.y+j.height,this.angle!=0&&d.comm.setMatrixRotate(this.polyAR,this.angle).setMatrixRotate(this.polyBR,this.angle);var z=0,w=this.polyAR,g=this.aabbAR;while(z++<2){for(var y=0,B;B=w[y];y++){B[0]>A&&(A=B[0]),B[0]<C&&(C=B[0]),B[1]>m&&(m=B[1]),B[1]<x&&(x=B[1])}g[0][0]=C,g[0][1]=x,g[1][0]=A,g[1][1]=x,g[2][0]=A,g[2][1]=m,g[3][0]=C,g[3][1]=m,w=this.polyBR,g=this.aabbBR}E=j=C=A=x=m=null}}return k=e=q=null,this},d.action.Role.prototype.action=function(){var q=this.getSprite();if(!q){return this}var j=q.getFrame(),g=0,m=0;if(j){this.updateFrameParam();if(this._path.length>0){var w=this._path.shift();
g=w[0]||0,m=w[1]||0,w=null,this._skipMoveDs||this.setSprite(this._moveDs[this.dsIndex=b(g,m)],!0),this.svx=g,this.svy=m,this.mapOffx+=this.svx,this.mapOffy+=this.svy}else{this.svx!=null&&this.svy!=null&&(this._skipMoveDs||(this.setSprite(this._stopedAction||this._stopDs[this.dsIndex=b(this.svx,this.svy)]),this._stopedAction=null),this.onend&&this.onend(this),this._skipMoveDs=!1,this.svx=null,this.svy=null)}if(this._zooms.length>0){var h=this._zooms.shift();typeof ~~h=="number"&&this.setZoom(h),h=null}if(this._angles.length>0){var v=this._angles.shift();typeof ~~v=="number"&&this.setRotate(v),h=null}this.x+=j.args[1]+g,this.y+=j.args[2]+m;var t;for(var p=0,k;k=this.links[p];p++){k.x=this.x+(k.dx||0),k.y=this.y+(k.dy||0),k.getSprite().setFrame(q.current),k.updateFrameParam()}t=null}return q.nextFrame(),q=g=m=j=null,this},d.action.Role.prototype.render=function(D){var k=this.getSprite();if(k&&this._fA){var e=this._fA,q=e.length,E=d.canvas,j=k.trans,C,A,x;if(this.angle>0){var m=e[0],z=this.x,w=this.y;d.canvas.save().translate(z,w).rotate(this.angle*Math.PI/180).translate(-z,-w),m=z=w=null}for(var g=0;g<q;g++){C=this.rects[e[g][0]][e[g][1]],A=this.imageNames[e[g][0]],x=d.getImage(A),j==d.trans.TRANS_NONE?E.drawImage(A,C[0],C[1],C[2],C[3],this.zoom==1?~~(this.x+this.dx+e[g][2]*this.zoom):this.x+this.dx+e[g][2]*this.zoom,this.zoom==1?~~(this.y+this.dy+e[g][3]*this.zoom):this.y+this.dy+e[g][3]*this.zoom,C[2]*this.zoom,C[3]*this.zoom):this.zoom==1?E.drawRegion(A,C[0],C[1],C[2],C[3],j,~~(this.x+this.dx-(e[g][2]+C[2])),~~(this.y+this.dy+e[g][3])):E.drawRegionAndZoom(A,C[0],C[1],C[2],C[3],j,this.x+this.dx-(e[g][2]+C[2])*this.zoom,this.y+this.dy+e[g][3]*this.zoom,null,C[2]*this.zoom,C[3]*this.zoom),!x.loaded&&x.bench&&E.drawImage(x.bench.id||x.benchId,x.bench.sx||0,x.bench.sy||0,x.bench.sw||x.bench.w,x.bench.sh||x.bench.h,~~(this.x+this.dx-(x.bench.w*this.zoom>>1)),~~(this.y+this.dy-x.bench.h*this.zoom),x.bench.w*this.zoom,x.bench.h*this.zoom)}this.angle>0&&d.canvas.restore();for(var y=0,B;B=this.links[y];y++){B.render()}E=q=e=j=C=A=x=null}return k=null,this},d.action.Role.prototype.setZoom=function(g){return this.zoom=g,this},d.action.Role.prototype.setZoomTransition=function(g){return g&&g.length>0&&(this._zooms=g),this},d.action.Role.prototype.endZoomTransition=function(){return this._zooms.length==0},d.action.Role.prototype.getBodyRect=function(g,k){var j=this.getSprite(g!=null?Math.abs(g):null);if(!j){return null}var e=j.getFrame(k);if(!e){return null}var h=this.frames[e.args[0]].bR;return g==null&&j.trans!=d.trans.TRANS_NONE||g<0?{x:-(h[0]+h[2]*this.zoom),y:h[1]*this.zoom,width:h[2]*this.zoom,height:h[3]*this.zoom}:{x:h[0]*this.zoom,y:h[1]*this.zoom,width:h[2]*this.zoom,height:h[3]*this.zoom}},d.action.Role.prototype.getAttackRect=function(g,k){var j=this.getSprite(g!=null?Math.abs(g):null);if(!j){return null}var e=j.getFrame(k);if(!e){return null}var h=this.frames[e.args[0]].aR;return g==null&&j.trans!=d.trans.TRANS_NONE||g<0?{id:this.id,x:-(h[0]+h[2]*this.zoom),y:h[1]*this.zoom,width:h[2]*this.zoom,height:h[3]*this.zoom}:{id:this.id,x:h[0]*this.zoom,y:h[1]*this.zoom,width:h[2]*this.zoom,height:h[3]*this.zoom}},d.action.Role.prototype.getAABBBodyRect=function(){return{id:this.id,x:this.aabbBR[0][0],y:this.aabbBR[0][1],width:Math.abs(this.aabbBR[1][0]-this.aabbBR[0][0]),height:Math.abs(this.aabbBR[2][1]-this.aabbBR[1][1])}},d.action.Role.prototype.getAABBAttackRect=function(){return{id:this.id,x:this.aabbAR[0][0],y:this.aabbAR[0][1],width:Math.abs(this.aabbAR[1][0]-this.aabbAR[0][0]),height:Math.abs(this.aabbAR[2][1]-this.aabbAR[1][1])}},d.action.Role.prototype.setStep=function(k){this.step=k||0;for(var h=0,l=this.sprites.length;h<l;h++){this.sprites[h].setStep(k)}for(var j=0,g;g=this.links[j];j++){g.setStep(this.step)}return this},d.action.Role.prototype.collision=function(h,m,k){if(!h){return !1}var g=m||"aR",j=k||"aR",l,e;return g=="aR"?l=this.getAttackRect():g=="bR"&&(l=this.getBodyRect()),j=="aR"?e=h.getAttackRect():j=="bR"&&(e=h.getBodyRect()),l&&e?d.comm.collision(~~(this.x+this.dx+l.x),~~(this.y+this.dy+l.y),~~l.width,~~l.height,~~(h.x+h.dx+e.x),~~(h.y+h.dy+e.y),~~e.width,~~e.height):!1},d.action.Role.prototype.collisionInput=function(h,m,k,g,j){var l=j||"aR",e;return l=="aR"?e=this.getAttackRect():l=="bR"&&(e=this.getBodyRect()),e?d.comm.collision(~~(this.x+this.dx+e.x),~~(this.y+this.dy+e.y),~~e.width,~~e.height,h,m,k,g):!1},d.action.Role.prototype.circleCollisionInput=function(g,l,j,e){var h=e||"aR",k;return h=="aR"?k=this.getAttackRect():h=="bR"&&(k=this.getBodyRect()),k?d.comm.rect2CircleCollision(~~(this.x+this.dx+k.x),~~(this.y+this.dy+k.y),~~k.width,~~k.height,g,l,j):!1},d.action.Role.prototype.polygonSATCollision=function(h,m,k){if(!h){return !1}var g=m||"aR",j=k||"aR",l,e;return g=="aR"?l=this.polyAR:g=="bR"&&(l=this.polyBR),j=="aR"?e=h.polyAR:j=="bR"&&(e=h.polyBR),l&&e?d.comm.polygonCollision(l,e,this.x+this.dx,this.y+this.dy,h.x+h.dx,h.y+h.dy):!1},d.action.Role.prototype.setLoop=function(h){for(var g=0,i=this.sprites.length;
g<i;g++){this.sprites[g].setLoop(h)}return this},d.action.Role.prototype.setPath=function(h,g){return this._path=h||[],this._path.length>0&&this.onstart&&this.onstart(this),g&&(this._skipMoveDs=!0),this},d.action.Role.prototype.concatPath=function(g){return this._path=this._path.concat(g||[]),this},d.action.Role.prototype.endPath=function(){return this._path.length==0},d.action.Role.prototype.clearPath=function(){return this._path=[],this},d.action.Role.prototype.getPathCount=function(){return this._path.length},d.action.Role.prototype.getFirstPath=function(){return this._path.length>0?this._path[0]:[0,0]},d.action.Role.prototype.moveTo=function(e,h,g){return g&&(this.speed=Math.abs(g)),this.setPath(d.comm.createPath(this.mapOffx,this.mapOffy,e,h,this.speed)),this},d.action.Role.prototype.setMoveDs=function(g){return this._moveDs=g||[4,7,5,5,6,-5,-5,-7],this},d.action.Role.prototype.setStopDs=function(g){return this._stopDs=g||[0,-3,1,1,2,-1,-1,-3],this},d.action.Role.prototype.doMoveDs=function(g){return g!=null&&g>=0&&g<8&&(this.dsIndex=g),this.setSprite(this._moveDs[this.dsIndex]),this},d.action.Role.prototype.doStopDs=function(g){return g!=null&&g>=0&&g<8&&(this.dsIndex=g),this.setSprite(this._stopDs[this.dsIndex]),this},d.action.Role.prototype.mark=function(i,g,j,h){return i!=null&&(this.x=i),g!=null&&(this.y=g),j!=null&&(this.mapOffx=j),h!=null&&(this.mapOffy=h),this},d.action.Role.prototype.setSpeed=function(h,g){return h&&(this.speed=Math.abs(h)),this.nodeXStep=h,this.nodeYStep=g,this},d.action.Role.prototype.setRotate=function(g){return g!=this.angle&&(Math.abs(g)>360&&(g%=360),this.angle=g<0?360+g:g),this},d.action.Role.prototype.setRotateTransition=function(g){return g&&g.length>0&&(this._angles=g),this},d.action.Role.prototype.endRotateTransition=function(){return this._angles.length==0},d.action.Role.prototype.move=function(h,g){return h!=null&&(this.x+=h),g!=null&&(this.y+=g),this},d.action.Role.prototype.rotate=function(g){return g!=null&&this.setRotate(this.angle+g),this},d.action.Role.prototype.stoped=function(){return this.svx==null},d.action.Role.prototype.getCurrent=function(){return this.current*(this.getSprite().trans==d.trans.TRANS_NONE?1:-1)},d.action.Sprite=function(g,j,h,e){this.frames=g||[],this.loop=j,this.current=h||0,this.step=e||0,this.trans=d.trans.TRANS_NONE,this.setFrame(h),this.runStep=this.getFrame().step||this.step},d.action.Sprite.prototype.setFrame=function(g){return this.current=g>=this.frames.length?this.frames.length-1:g>0?g:0,this.getFrame().step&&(this.runStep=this.getFrame().step),this},d.action.Sprite.prototype.getFrame=function(g){return this.frames[g==null?this.current:g]},d.action.Sprite.prototype.nextFrame=function(){return !this.loop&&this.endFrame()?this:(this.frames.length>0&&(this.runStep<=0?(this.loop?(this.current++,this.current%=this.frames.length):this.current<this.frames.length-1&&this.current++,this.getFrame().step?this.runStep=this.getFrame().step:this.runStep=this.step):this.runStep--),this)},d.action.Sprite.prototype.preFrame=function(){return this.frames.length>0&&(this.runStep<=0?(this.loop?(this.current--,this.current<0&&(this.current=this.frames.length-1)):this.current>0&&this.current--,this.getFrame().step?this.runStep=this.getFrame().step:this.runStep=this.step):this.runStep--),this},d.action.Sprite.prototype.endFrame=function(h){var g=this.frames.length-1;return h!=null&&h>=0&&h<=this.frames.length-1&&(g=h),this.current>=g&&this.runStep==0},d.action.Sprite.prototype.firstFrame=function(){return this.current==0&&this.runStep==0},d.action.Sprite.prototype.setStep=function(g){return this.step=g||0,this.runStep=this.getFrame().step||this.step,this},d.action.Sprite.prototype.setLoop=function(g){return this.loop=g,this};var c,a=function(g){return g.sprites.length>0?g.sprites[0].frames.length>0&&(g.sprites[0].runStep<=0?(g.sprites[0].runStep=g.sprites[0].step,c=g.sprites[0].frames.shift(),g.sprites[0].frames.length==0&&g.sprites.shift()):(c=g.sprites[0].getFrame(),g.sprites[0].runStep--)):c=null,c};return d.action.Fragment=function(g){this.sprites=g||[]},d.action.Fragment.prototype.queue=function(){return a(this)},d.action.role=d.action.Role,d.action.sprite=d.action.Sprite,d.action.fragment=d.action.Fragment,link.action}),define("host",["lib/link"],function(d){d.asyncImage([{id:"host",src:"images/xiaoren.png"}]);var b=["host"],f=[[[0,0,26,37],[27,0,19,36],[46,0,22,38]]],c=[{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,0,-14,-37,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,1,-9,-36,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,2,-12,-37,0]]}],a=[{loop:!0,frames:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[1,0,0,0]]}];return{get:function(g,h){var e=g>=0&&a[g]?[a[g]]:a;return new d.action.role([],0,0,0,h?h:b,f,c,e||a)}}}),define("shine",["lib/link"],function(d){d.asyncImage([{id:"shine",src:"images/wu.png"}]);var b=["shine"],f=[[[0,20,101,64],[119,19,112,66],[238,13,140,80],[391,0,103,100]]],c=[{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,0,-51,-34,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,1,-54,-34,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,2,-58,-35,0]]},{aR:[-15,-30,30,30],bR:[-10,-25,20,20],fA:[[0,3,-49,-45,0]]}],a=[{loop:!1,frames:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[3,0,0,0]]}];
return{get:function(g,h){var e=g>=0&&a[g]?[a[g]]:a;return new d.action.role([],0,0,0,h?h:b,f,c,e||a)}}}),define("index",["lib/link","lib/action","host","shine"],function(c,a,d,b){return{init:function(){var r=Date.now(),j,v,e=640,q;c.canvas.screen.getTouch()?(j=window.innerWidth,v=window.innerHeight,c.canvas.screen.setWidth(j).setHeight(v),q=v-e>>1):(window.onresize=function(){j=window.innerWidth,v=window.innerHeight,c.canvas.screen.setWidth(j).setHeight(v),q=v-e>>1},window.onresize());var p=function(h,f){var i=~~(h/1000%1*1000);return i==0?i="000":i<100&&(i+="0"),~~(h/1000)+"."+i+(f||'"')};c.run(function(){var h=Date.now();c.canvas.fillStyle("#FFF").fillScreen();var u=~~(e/g.scenes.length);if(!g.died){g.time=h-g.date;for(var i=0,l;l=g.scenes[i];i++){l.action(0,q+(i+1)*u,j,u,-8).render();if(l.hostDied){g.died=!0,g.dieDate=Date.now(),g.shine=b.get(0).mark(l.host.x,l.host.y-20).setStep(2);break}}}else{for(var i=0,l;l=g.scenes[i];i++){l.host.action(),l.render()}g.shine&&(g.shine.action().render(),g.shine.getSprite().endFrame()&&(g.shine=null)),h-g.dieDate>=g.dieTimeout&&(g.dieDate=null,k())}var o=p(g.time);c.canvas.fillStyle("#000").font("30px Arial").fillText(o,j-c.canvas.measureText(o).width-20,50),h=null}).menu(function(){c.canvas.fillStyle("#FFF").fillScreen().drawImage("logo",j-480>>1,q).drawImage("btns1",0,99,480,7,j-480>>1,q+140,480,7).drawImage("btns1",0,99,480,7,j-480>>1,q+555,480,7),c.buttonLayout.released("difficulty1")?(g.moduleName="我的成绩",hideAd(),n(2)):c.buttonLayout.released("difficulty2")?(g.moduleName="噩梦模式",n(3)):c.buttonLayout.released("difficulty3")?(g.moduleName="地狱模式",n(4)):c.buttonLayout.released("difficulty4")?(g.moduleName="炼狱模式",n(5)):c.buttonLayout.released("rank")&&dp_Ranking()}).zone(function(){c.canvas.fillStyle("#90EE90").fillScreen().fillStyle("#FFF").drawString(g.moduleName,0,q+110,c.graphics.VCENTER,!1,null,null,"50px 微软雅黑").drawImage("btns1",0,106,480,7,j-480>>1,q+140,480,7).drawImage("btns1",0,106,480,7,j-480>>1,q+555,480,7).fillStyle("#000").drawString(p(g.time,"秒"),0,q+340,c.graphics.VCENTER,!1,null,null,"60px 微软雅黑").fillStyle("#000").drawString("最佳:"+p(g.bestTime,"秒"),0,q+400,c.graphics.VCENTER,!1,null,null,"30px 微软雅黑"),g.time>g.bestTime&&c.canvas.fillStyle("#FF0").drawString("新纪录",0,q+240,c.graphics.VCENTER,!1,null,null,"50px 微软雅黑"),c.buttonLayout.released("return")?m():c.buttonLayout.released("restart")&&dp_share2(g.time)}).events.mouseDown(function(o,h,s){if(g.died){return !1}for(var l=0,f;f=g.scenes[l];l++){f.touchStart(h,s)}}).touchStart(function(o,h,s){if(g.died){return !1}for(var l=0,f;f=g.scenes[l];l++){f.touchStart(h,s)}});var m=function(){showAd();c.buttonLayout.clear().create({id:"difficulty1",value:"开始游戏",x:j-272>>1,y:q+180,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).create({id:"difficulty2",value:"噩梦模式",x:j-272>>1,y:q+160+120,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).create({id:"difficulty3",value:"地狱模式",x:j-272>>1,y:q+160+120+100,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).create({id:"difficulty4",value:"炼狱模式",x:j-272>>1,y:q+160+120+200,width:272,height:80,font:"36px 微软雅黑",imageId:"btns1",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#FFF",dex:272,dey:0,deColor:"#000"}).base().gameFlow.menu()};m();var g={moduleName:"",module:0,time:0,bestTime:0,date:null,died:!1,dieTimeout:1000,dieDate:null,scenes:[],shine:null,Scene:c.extend(function(f){this.id=f,this.x=0,this.baseY=0,this.width=0,this.height=0,this.host=d.get().setStep(2),this.hostDied=!1,this.boxes=[],this.displayDate=Date.now(),this.displayTimeout=c.comm.getRandom(1000,2000)},null,{render:function(){c.canvas.fillStyle("#000").fillRect(this.x,this.baseY-5,this.width,5);for(var f=this.boxes.length-1,h;h=this.boxes[f];f--){c.canvas.fillRect(h.x,h.y,h.width,h.height)}return this.host.render(),this},action:function(D,x,h,z,E){this.x=D,this.baseY=x,this.width=h,this.height=z;if(!this.hostDied){this.host.endPath()&&this.host.mark(this.x+100,this.baseY-5);var w=Date.now();if(w-this.displayDate>=this.displayTimeout){this.displayDate=w;var C=c.comm.getRandom(5,30),B=c.comm.getRandom(10,50);this.boxes.unshift({x:this.width,y:0,width:C,height:B}),this.displayTimeout=c.comm.getRandom(1000,3000),C=B=null}for(var A=this.boxes.length-1,y;y=this.boxes[A];A--){y.x+=E,y.y=this.baseY-5-y.height,this.host.collisionInput(y.x,y.y,y.width,y.height,"bR")&&(this.hostDied=!0,this.host.clearPath()),(y.x<=-y.width||y.x>=this.width)&&this.boxes.splice(A,1)}w=null}return this.host.action(),this},touchStart:function(f,h){return this.host.endPath()?(c.comm.collision(f,h,1,1,this.x,this.baseY-this.height,this.width,this.height)&&this.host.setPath([[0,-20],[0,-20],[0,-20],[0,-10],[0,-10],[0,-10],[0,-5],[0,-5],[0,-5],[0,5],[0,5],[0,5],[0,10],[0,10],[0,10],[0,20],[0,20],[0,20]]),this):this
}})},n=function(f){c.buttonLayout.clear().base().gameFlow.run(),g.died=!1,g.scenes=[],g.time=0,g.date=Date.now(),g.shine=null,g.module=f;for(var h=0;h<f;h++){g.scenes.push(new g.Scene(h))}},k=function(){var f=j-480>>1;if(g.time>10000){dp_share(g.time);alert("强！你居然坚持了"+g.time/1000+"秒！")}c.buttonLayout.clear().create({id:"return",value:"返回游戏主界面",bgColor:"",bgStroke:"",stroke:"",x:f+100,y:q+580,width:300,height:80,font:"36px 微软雅黑",imageId:"",sx:0,sy:0,color:"#FFF",hx:272,hy:0,hColor:"#AAA",dex:272,dey:0,deColor:"#CCC"}).base().gameFlow.zone();var h=c.localStorage.getItem("NotDieAnyoneBestTime"+g.module);h==null&&(h="0"),g.bestTime=parseInt(h),g.time>g.bestTime&&c.localStorage.setItem("NotDieAnyoneBestTime"+g.module,g.time.toString()),dp_submitScore(g.module,g.time*(g.module-1))}}}}),require.config({baseUrl:"js"}),require(["lib/link","index"],function(b,a){b.init(window.innerWidth,window.innerHeight).pushImage([{id:"logo",src:"images/ygdbns.jpg"},{id:"btns1",src:"images/gdyx.png"}],function(d,c,f){}).initAudio([{id:"1",src:"",preload:!0}]).loadingCallBack(function(d,c){}).main(function(){a.init()})}),define("main",function(){});function dp_submitScore(a,b){}function dp_share(a){}function dp_share2(a){}function showAd(){}function hideAd(){};