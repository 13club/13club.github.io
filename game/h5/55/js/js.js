function startgame(){gametimer=setInterval(drawcanvas,50),document.getElementById("gamestart").style.display="none"}function drawcanvas(){var e=document.getElementById("canvas1").getContext("2d");e.clearRect(0,0,bodywidth,bodyheight),function(){bgArr.x=bgArr.x-bgArr.bgspeed,bgArr.x<=-bodywidth&&(bgArr.x=0);bgArr.borderx=bgArr.borderx-bgArr.bgborderspeed,bgArr.borderx<=-bodywidth-40&&(bgArr.borderx=0,bgArr.rockynum=Math.floor(3*Math.random()));planemove.y<bodyheight&&planescore++;bgArr.bgborderspeed=10+Math.floor(planescore/20),bgArr.border=bgArr.border+bgArr.borderspeed,(bgArr.border>40||bgArr.border<=0)&&(bgArr.borderspeed=-1*bgArr.borderspeed);bomb?(planemove.speed=planemove.speed+1.5,planemove.planeAngle=planemove.planeAngle-50):1==downisflag?(planemove.speed=planemove.speed-.4,planemove.planeAngle=planemove.planeAngle-1.2):(1==ondblclick&&(planemove.speed=planemove.speed-8,planemove.planeAngle=planemove.planeAngle-24,ondblclick=!1),planemove.speed=planemove.speed+.4,planemove.planeAngle=planemove.planeAngle+1.2);planemove.y=planemove.y+planemove.speed,planemove.shap++,planemove.shap>=4&&(planemove.shap=0);switch(bgArr.rockynum){case 0:bgArr.rocky=bgArr.border+17;break;case 1:bgArr.rocky=(bodyheight-100)/2;break;case 2:bgArr.rocky=bodyheight-120-bgArr.border}}(),function(){testwall(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.x,0),e.drawImage(bgimg,0,0,320,460,0,0,bodywidth,bodyheight),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.x+bodywidth,0),e.drawImage(bgimg,0,0,320,460,0,0,bodywidth,bodyheight),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.borderx,bgArr.border),e.drawImage(bgtopimg,0,0,320,20,0,0,bodywidth,20),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.borderx+bodywidth,bgArr.border),e.drawImage(bgtopimg,0,0,320,20,0,0,bodywidth,20),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.borderx,bodyheight-20-bgArr.border),e.drawImage(bgtopimg,0,0,320,20,0,0,bodywidth,20),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.borderx+bodywidth,bodyheight-20-bgArr.border),e.drawImage(bgtopimg,0,0,320,20,0,0,bodywidth,20),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0),e.translate(bgArr.borderx+bodywidth,bgArr.rocky),e.drawImage(rockimg,0,0,40,100,0,0,40,100),e.restore(),e.save(),e.setTransform(1,0,0,1,0,0);var r=planemove.planeAngle*Math.PI/180;e.translate(100,planemove.y+16),e.rotate(r),0==planemove.shap?e.drawImage(planeimg0,0,0,48,32,-24,-16,48,32):1==planemove.shap?e.drawImage(planeimg1,0,0,48,32,-24,-16,48,32):2==planemove.shap?e.drawImage(planeimg2,0,0,48,32,-24,-16,48,32):3==planemove.shap&&e.drawImage(planeimg3,0,0,48,32,-24,-16,48,32);e.restore(),e.save();var t=e.createLinearGradient(150,0,250,0);t.addColorStop(0,"rgb(255,255,255)"),t.addColorStop(.5,"rgb(0,0,0)"),t.addColorStop(1,"rgb(255,255,255)"),e.fillStyle=t,e.font="italic bold 30px serif",e.fillText("score:"+Math.floor(planescore/10),150,100),e.restore()}()}function testwall(){if((planemove.y<=bgArr.border+20||planemove.y>=bodyheight-50-bgArr.border)&&(bomb=!0),bgArr.borderx+bodywidth-20<=100&&100<=bgArr.borderx+bodywidth+40)switch(bgArr.rockynum){case 0:planemove.y<=bgArr.border+117&&(bomb=!0);break;case 1:(bodyheight-100)/2-32<=planemove.y&&planemove.y<=(bodyheight-100)/2-32+135&&(bomb=!0);break;case 2:planemove.y>=bodyheight-150-bgArr.border&&(bomb=!0)}planemove.y>bodyheight&&(document.getElementById("gameend").style.display="block",document.getElementById("gameendbtn").style.display="block",document.getElementById("score").innerHTML="",document.getElementById("score").innerHTML="您的分数"+Math.floor(planescore/10))}function restart(){document.getElementById("gameend").style.display="none",document.getElementById("gameendbtn").style.display="none",bomb=!1,ondblclick=!1,planemove={y:150,shap:0,speed:0,blast:3,planeAngle:0},bgArr.bgborderspeed=10,planescore=0}function blast(){$("bg_0").style.webkit="paused",clearInterval(bgtimer)}function getTransLateX(e){var r,t,o=("object"==typeof e?e:$(e)).style.webkitTransform;return r=o.indexOf("("),t=o.indexOf("px"),r?o.substring(r+1,t):0}window.onload=function(){body=document.body,bodywidth=window.innerWidth,bodyheight=window.innerHeight,body.style.height=bodyheight+"px",body.style.width=bodywidth+"px",document.getElementById("gamepage").style.width=bodywidth+"px",document.getElementById("gamepage").style.height=bodyheight+"px",document.getElementById("canvas1").width=bodywidth,document.getElementById("canvas1").height=bodyheight,document.getElementById("gamestart").style.width=bodywidth+"px",document.getElementById("gamestart").style.height=bodyheight+"px";document.getElementById("canvas1").addEventListener("dblclick",function(e){e.stopPropagation(),e.preventDefault(),ondblclick=!0},!1),document.getElementById("canvas1").addEventListener(START_EVENT,function(e){try{if(e.touches.length>1)return e.stopPropagation(),void e.preventDefault()}catch(e){}downisflag=!0,istouchstart=!0},!1),document.getElementById("canvas1").addEventListener(END_EVENT,function(e){try{if(e.touches.length>1)return e.stopPropagation(),void e.preventDefault()}catch(e){}downisflag=!1,istouchstart=!1},!1),document.addEventListener(MOVE_EVENT,function(e){if(istouchstart){try{if(e.touches.length>1)return e.stopPropagation(),void e.preventDefault()}catch(e){}e.stopPropagation(),e.preventDefault(),downisflag=!0}},!1),drawcanvas()};