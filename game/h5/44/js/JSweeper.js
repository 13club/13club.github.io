var JSweeper=JSweeper||function(){};(JSweeper=function(){var t={easy:{x:8,y:8,mines:10},mid:{x:16,y:16,mines:40},hard:{x:16,y:30,mines:99}},n=[],e=[],o="easy";return $mineContainer=$("#mine-grid"),$mineCount=$(".mine-count"),timer=!1,_createMines=function(t){var i,o,r,a=t.x,s=t.y,u=t.mines;for(i=0;i<a;i++)for(o=0;o<s;o++)n.push({x:i,y:o,mine:0,status:0});for(;u;)r=Math.floor(Math.random()*n.length),0===n[r].mine&&(n[r].mine=1,e.push(r),u--)},_initBoard=function(e){var i,o,r,a=e||t.easy,s=10===a.mines?"easy":40===a.mines?"mid":"hard";for($mineContainer.parent().removeClass().addClass(s),$mineCount.text(a.mines),_createMines(a),i=0;i<n.length;i++)r='<button data-x="'+(o=n[i]).x+'" data-y="'+o.y+'">',r+="</button>",$mineContainer.append(r)},_startTimer=function(){var t=$(".timer");t.text("001"),timer=setInterval(function(){for(var n=parseInt(t.text(),10)+1+"";n.length<3;)n="0"+n;t.text(n)},1e3)},_stopTimer=function(){clearInterval(timer),timer=!1},_getButtonIdx=function(t,e){var i;n.filter(function(n,o){if(n.x==t&&n.y==e)return i=o,!0});return i>=0?i:-1},_getMinesInButton=function(t,e){var i=_getButtonIdx(t,e);return n[i]&&n[i].mine||0},_checkSurroundingMines=function(t,e){t=parseInt(t,10),e=parseInt(e,10);var i,o=n[_getButtonIdx(t,e)]||0;o&&0===o.status&&((i=_getMinesInButton(t-1,e-1)+_getMinesInButton(t,e-1)+_getMinesInButton(t+1,e-1)+_getMinesInButton(t-1,e)+_getMinesInButton(t+1,e)+_getMinesInButton(t-1,e+1)+_getMinesInButton(t,e+1)+_getMinesInButton(t+1,e+1))&&!o.mine?_openButton(t,e,i):o.mine||(_openButton(t,e),_checkSurroundingMines(t-1,e-1),_checkSurroundingMines(t,e-1),_checkSurroundingMines(t+1,e-1),_checkSurroundingMines(t-1,e),_checkSurroundingMines(t+1,e),_checkSurroundingMines(t-1,e+1),_checkSurroundingMines(t,e+1),_checkSurroundingMines(t+1,e+1)))},_flagButton=function(t){t.preventDefault(),console.log(timer),timer||_startTimer();var e=$(this),i=parseInt(e.attr("data-x"),10),o=parseInt(e.attr("data-y"),10),r=_getButtonIdx(i,o),a=n[r],s=$("[data-x="+i+"][data-y="+o+"]"),u=parseInt($mineCount.text(),10);0===a.status?(n[r].status=2,$mineCount.text(u-1),_hasWon()):2===a.status&&(n[r].status=0,$mineCount.text(u+1)),s.toggleClass("flagged")},_pressButton=function(t){var e,i,o,r;console.log(timer),timer||_startTimer(),1===t.which&&(i=(e=$(this)).attr("data-x"),o=e.attr("data-y"),r=_getButtonIdx(i,o),n[r].mine?(_openButton(i,o,"explode"),_explodeMines()):_checkSurroundingMines(i,o))},_explodeMines=function(){var t,e,i=n.length;for(_stopTimer(),t=0;t<i;t++)(e=n[t]).mine&&1!==e.status&&_openButton(e.x,e.y)},_allMinesFlagged=function(){for(i=0;i<e.length;i++)if(2!=n[e[i]].status)return!1;return!0},_allBoxesOpen=function(){var t;for(i=0;i<n.length;i++)if(!(t=n[i]).mine&&1!==t.status)return!1;return!0},_hasWon=function(){(_allMinesFlagged()||_allBoxesOpen())&&_stopTimer()},_openButton=function(t,e,i){var o=_getButtonIdx(t,e),r=n[o],a=$("[data-x="+t+"][data-y="+e+"]");"explode"===i?a.addClass("exploded").append("*"):(a.addClass("open"),parseInt(i,10)?a.append(i):r.mine&&a.append("*")),n[o].status=1,_hasWon()},_cleanBoard=function(){n=[],$mineContainer.empty()},_resetBoard=function(t){_cleanBoard(),_initBoard(t)},_initEvents=function(){$(".level-select").on("click","button",function(){var n=$(this).attr("data-level");_stopTimer(),o=n,_resetBoard(t[n])}),$mineContainer.on("mousedown","button",_pressButton),$mineContainer.on("contextmenu","button",_flagButton),$(".reset").on("click",function(){var n=o;_stopTimer(),_startTimer(),_resetBoard(t[n])})},_init=function(){_initEvents(),_initBoard()},{init:_init,g:_getButtonIdx}}()).init();