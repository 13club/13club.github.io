var arr=[];function getId(r){return document.getElementById(r)}function C(r){return document.getElementsByClassName(r)}var obj={ROW:4,CELL:4,r:0,c:0,f:0,keyCd:0,score:0,createEle:0,eleFragment:"",gameStart:function(){obj.init(),obj.musicplay(1),document.onkeydown=function(r){switch(r.keyCode){case 37:obj.keyCd=1,obj.moveLeft(),obj.musicplay(3);break;case 38:obj.keyCd=2,obj.moveUp(),obj.musicplay(3);break;case 39:obj.keyCd=1,obj.moveRight(),obj.musicplay(3);break;case 40:obj.keyCd=2,obj.moveDown(),obj.musicplay(3)}getId("score").innerHTML=obj.score}},musicplay:function(r){var e=getId("a1024"),o=getId("a512"),a=getId("lose"),c=getId("a2"),n=getId("winner");switch(r){case 0:e.play();break;case 1:o.play();break;case 2:a.play();break;case 3:c.play();break;case 4:n.play()}},buttonsclick:function(r){var e=getId("buton1"),o=getId("buton2"),a=getId("buton3"),c=getId("buton4");e.onclick=function(){obj.keyCd=2,obj.moveUp(),obj.musicplay(3),getId("score").innerHTML=obj.score},o.onclick=function(){obj.keyCd=1,obj.moveLeft(),obj.musicplay(3),getId("score").innerHTML=obj.score},a.onclick=function(){obj.keyCd=2,obj.moveDown(),obj.musicplay(3),getId("score").innerHTML=obj.score},c.onclick=function(){obj.keyCd=1,obj.moveRight(),obj.musicplay(3),getId("score").innerHTML=obj.score}},init:function(){for(obj.eleFragment=document.createDocumentFragment(),r=0;r<obj.ROW;r++)for(arr.push([]),c=0;c<obj.CELL;c++)arr[r][c]=0,1==obj.createEle&&obj.create(r,c);1==obj.createEle&&(obj.createEle=0,getId("gridPanel").innerHTML="",getId("gridPanel").appendChild(obj.eleFragment)),obj.score=0,getId("score").innerHTML=obj.score,getId("game").style.display="none",getId("gameover").style.display="none",obj.random(),obj.random(),obj.updateView()},create:function(r,e){var o,a,c,n,t,i,b,l,j=14;o=document.createElement("div"),a=document.createElement("div"),o.id="g"+r+e,o.className="grid",a.id="c"+r+e,a.className="cell",3==obj.ROW?j=24:4==obj.ROW&&(j=18),t=i=(480-(c=n=b=l=66+(6-obj.ROW)*j)*obj.ROW)/(obj.ROW+1),o.style.width=c+"px",o.style.height=n+"px",o.style.marginTop=t+"px",o.style.marginLeft=i+"px",a.style.width=b+"px",a.style.height=l+"px",a.style.top=t+r*(t+b)+"px",a.style.left=i+e*(i+l)+"px",a.style.lineHeight=l+"px",a.style.fontSize=15+10*(6-obj.ROW)+"px",a.style.transition="1s",obj.eleFragment.appendChild(o),obj.eleFragment.appendChild(a)},random:function(){for(;;){var r=Math.floor(Math.random()*obj.ROW),e=Math.floor(Math.random()*obj.CELL);if(0==arr[r][e]){arr[r][e]=Math.random()>.5?4:2;break}}},updateView:function(){var e=0;for(r=0;r<obj.ROW;r++)for(c=0;c<obj.CELL;c++)0==arr[r][c]?(getId("c"+r+c).innerHTML="",getId("c"+r+c).className="cell"):(getId("c"+r+c).innerHTML=arr[r][c],getId("c"+r+c).className="cell n"+arr[r][c],3==obj.ROW&&1024==arr[r][c]?e=1:4==obj.ROW&&2048==arr[r][c]?e=1:5==obj.ROW&&4096==arr[r][c]?e=1:6==obj.ROW&&8192==arr[r][c]&&(e=1));1==e&&(obj.musicplay(4),getId("game").style.display="block",getId("gameover").style.display="block",getId("Score").innerHTML="You win!<br>Score:"+obj.score),obj.isGameOver()&&(obj.musicplay(2),getId("game").style.display="block",getId("gameover").style.display="block",getId("Score").innerHTML="GAME OVER!<br>Score:"+obj.score)},isGameOver:function(){for(r=0;r<obj.ROW;r++)for(c=0;c<obj.CELL;c++){if(0==arr[r][c])return!1;if(c!=obj.CELL-1&&arr[r][c]==arr[r][c+1])obj.musicplay(3);else if(r!=obj.ROW-1&&arr[r][c]==arr[r+1][c])return!1}return!0},find:function(r,e,o,a,c){if(2==obj.keyCd){if(1==c){for(var n=o;n<a;n+=c)if(0!=arr[n][e])return n}else for(n=o;n>=a;n+=c)if(0!=arr[n][e])return n}else if(1==c){for(n=o;n<a;n+=c)if(0!=arr[r][n])return n}else for(n=o;n>=a;n+=c)if(0!=arr[r][n])return n;return null},dealToLeft:function(r){var e;for(c=0;c<obj.ROW&&null!=(e=obj.find(r,c,c+1,obj.CELL,1));c++)0==arr[r][c]?(arr[r][c]=arr[r][e],arr[r][e]=0,c--):arr[r][c]==arr[r][e]&&(arr[r][c]*=2,arr[r][e]=0,obj.score+=arr[r][c])},move:function(r){var e;e=arr.toString(),r(),e!=arr.toString()&&(obj.random(),obj.updateView())},moveLeft:function(){obj.move(function(){for(r=0;r<obj.ROW;r++)obj.dealToLeft(r)})},dealToRight:function(r){var e;for(c=obj.CELL-1;c>=0&&null!=(e=obj.find(r,c,c-1,0,-1));c--)0==arr[r][c]?(arr[r][c]=arr[r][e],arr[r][e]=0,c++):arr[r][c]==arr[r][e]&&(arr[r][c]*=2,arr[r][e]=0,obj.score+=arr[r][c])},moveRight:function(){obj.move(function(){for(r=0;r<obj.ROW;r++)obj.dealToRight(r)})},dealToUp:function(e){var o;for(r=0;r<obj.ROW&&null!=(o=obj.find(r,e,r+1,obj.ROW,1));r++)0==arr[r][e]?(arr[r][e]=arr[o][e],arr[o][e]=0,r--):arr[r][e]==arr[o][e]&&(arr[r][e]*=2,arr[o][e]=0,obj.score+=arr[r][e])},moveUp:function(){obj.move(function(){for(c=0;c<obj.CELL;c++)obj.dealToUp(c)})},dealToDown:function(e){var o;for(r=obj.ROW-1;r>=0&&null!=(o=obj.find(r,e,r-1,0,-1));r--)0==arr[r][e]?(arr[r][e]=arr[o][e],arr[o][e]=0,r++):arr[r][e]==arr[o][e]&&(arr[r][e]*=2,arr[o][e]=0,obj.score+=arr[r][e])},moveDown:function(){obj.move(function(){for(c=0;c<obj.CELL;c++)obj.dealToDown(c)})}};function getModel(r){var e=r.target,o=4;"A"==e.nodeName&&("3X3"==e.innerHTML?o=3:"4X4"==e.innerHTML?o=4:"5X5"==e.innerHTML?o=5:"6X6"==e.innerHTML&&(o=6),obj.ROW=obj.CELL=o,obj.createEle=1,obj.gameStart())}window.onload=function(){obj.createEle=1,obj.gameStart(),obj.buttonsclick()};